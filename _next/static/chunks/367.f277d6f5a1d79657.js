(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[367],{838:(e,t,s)=>{"use strict";s.d(t,{Ay:()=>o});var a=s(4077);let n={CHATS:"messenger_chats",CONTACTS:"messenger_contacts",USER_PROFILE:"messenger_user_profile",SETTINGS:"messenger_settings",PROJECTS:"messenger_projects",DOCUMENTS:"messenger_documents"};class r{async save(e,t){try{await a.p.set({key:e,value:JSON.stringify(t)})}catch(t){throw console.error("Error saving data for key ".concat(e,":"),t),t}}async load(e){try{let{value:t}=await a.p.get({key:e});if(!t)return null;return JSON.parse(t)}catch(t){return console.error("Error loading data for key ".concat(e,":"),t),null}}async remove(e){try{await a.p.remove({key:e})}catch(t){throw console.error("Error removing data for key ".concat(e,":"),t),t}}async clear(){try{await a.p.clear()}catch(e){throw console.error("Error clearing all data:",e),e}}async saveChats(e){return this.save(n.CHATS,e)}async loadChats(){return await this.load(n.CHATS)||[]}async saveContacts(e){return this.save(n.CONTACTS,e)}async loadContacts(){return await this.load(n.CONTACTS)||[]}async saveUserProfile(e){return this.save(n.USER_PROFILE,e)}async loadUserProfile(){return this.load(n.USER_PROFILE)}async saveSettings(e){return this.save(n.SETTINGS,e)}async loadSettings(){return await this.load(n.SETTINGS)||{theme:"dark",notifications:!0}}async saveChatMessages(e,t){return this.save("".concat(n.CHATS,"_").concat(e,"_messages"),t)}async loadChatMessages(e){return await this.load("".concat(n.CHATS,"_").concat(e,"_messages"))||[]}async loadChatMessagesPaginated(e,t,s){let a=await this.loadChatMessages(e),n=Math.max(0,a.length-t*s),r=Math.min(a.length,n+s);return a.slice(n,r)}async getMessageCount(e){return(await this.loadChatMessages(e)).length}async deleteChatMessages(e){return this.remove("".concat(n.CHATS,"_").concat(e,"_messages"))}async saveProjects(e){return this.save(n.PROJECTS,e)}async loadProjects(){return await this.load(n.PROJECTS)||[]}async saveDocuments(e){return this.save(n.DOCUMENTS,e)}async loadDocuments(){return await this.load(n.DOCUMENTS)||[]}}class i{static async createStorage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"preferences";switch(e){case"preferences":default:return new r;case"sqlite":case"mongodb":return console.log("MongoDB adapter requested but not implemented - using Preferences instead"),new r}}static createStorageSync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"preferences";return"preferences"===e||console.log("".concat(e," adapter requested but sync creation only supports preferences - using Preferences instead")),new r}}let l=null;(async()=>{if(!l){l=new r;try{l=await i.createStorage("preferences"),console.log("Using preferences storage")}catch(e){console.error("Storage initialization error:",e)}}})();let o=new Proxy({},{get:(e,t)=>{let s=l;if(s)return s[t]}})},1832:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>e4});var a=s(5155),n=s(2115),r=s(2587),i=s(1733),l=s(6497),o=s(6711),c=s(1064),d=s(5225),u=s(7314),m=s(6204),h=s(3173),p=s(2663),g=s(5704);let x=[{id:1,title:"Willkommen bei Navicare Now",description:"Ihre digitale Unterst\xfctzung f\xfcr eine bessere Pflegeversorgung",icon:(0,a.jsx)(o.A,{className:"w-16 h-16 text-white"}),gradient:"from-blue-500 to-cyan-600",type:"intro",benefits:["Strukturierte Pflegebedarfsanalyse","Pers\xf6nliche Empfehlungen","Kontakt zu passenden Einrichtungen"]},{id:2,title:"Warum diese Fragen?",description:"Wir verstehen Ihre Situation und m\xf6chten Ihnen gezielt helfen",icon:(0,a.jsx)(c.A,{className:"w-16 h-16 text-white"}),gradient:"from-green-500 to-emerald-600",type:"intro",benefits:["Bessere Einsch\xe4tzung Ihrer Bed\xfcrfnisse","Ma\xdfgeschneiderte Unterst\xfctzungsangebote","Entlastung im Pflegealltag"]},{id:3,title:"Was Sie davon haben",description:"Ihre Antworten helfen uns, Ihnen die beste Unterst\xfctzung zu bieten",icon:(0,a.jsx)(d.A,{className:"w-16 h-16 text-white"}),gradient:"from-orange-500 to-red-600",type:"intro",benefits:["Individuelle Pflegeplanung","Digitale Pflegeakte","Pers\xf6nliche Begleitung"]},{id:4,title:"Ihre Pflegesituation",description:"Erz\xe4hlen Sie uns etwas \xfcber Ihre aktuelle Situation",icon:(0,a.jsx)(u.A,{className:"w-16 h-16 text-white"}),gradient:"from-purple-500 to-indigo-600",type:"question",question:{id:"who_care_for",text:"Wen pflegen Sie aktuell?",type:"checkbox",options:["Eltern","Ehepartner/in","Anderer Angeh\xf6riger","Nicht Verwandte Person (Freunde, Nachbarn)"],required:!0}},{id:5,title:"Dauer der Pflege",description:"Wie lange besteht bereits ein Pflegebedarf?",icon:(0,a.jsx)(o.A,{className:"w-16 h-16 text-white"}),gradient:"from-pink-500 to-rose-600",type:"question",question:{id:"care_duration",text:"Wie lange besteht bereits ein Pflegebedarf?",type:"radio",options:["Weniger als 6 Monate","6 - 12 Monate","1 - 3 Jahre","L\xe4nger als 3 Jahre"],required:!0}},{id:6,title:"Pflegegrad",description:"Welchen Pflegegrad hat die zu pflegende Person?",icon:(0,a.jsx)(c.A,{className:"w-16 h-16 text-white"}),gradient:"from-blue-500 to-cyan-600",type:"question",question:{id:"care_level",text:"Welchen Pflegegrad hat die zu pflegende Person?",type:"radio",options:["Noch keinen","1","2","3","4","5"],required:!0}},{id:7,title:"Zeitaufwand",description:"Wie viel Zeit wenden Sie f\xfcr die Pflege auf?",icon:(0,a.jsx)(o.A,{className:"w-16 h-16 text-white"}),gradient:"from-green-500 to-emerald-600",type:"question",question:{id:"hours_per_week",text:"Wie viele Stunden pro Woche wenden Sie durchschnittlich f\xfcr pflegerische Aufgaben auf?",type:"radio",options:["Weniger als 5","5 - 10","10 - 20","Mehr als 20","Eigentlich ist eine 24 Stunden Beaufsichtigung notwendig"],required:!0}},{id:8,title:"Belastung",description:"Wie stark f\xfchlen Sie sich belastet?",icon:(0,a.jsx)(o.A,{className:"w-16 h-16 text-white"}),gradient:"from-orange-500 to-red-600",type:"question",question:{id:"stress_level",text:"Wie stark f\xfchlen Sie sich durch die Pflegesituation belastet?",type:"radio",options:["Gar nicht","Ein wenig","Mittel","Stark","Sehr stark"],required:!0}},{id:9,title:"Zeitfresser",description:"Was kostet Sie am meisten Zeit?",icon:(0,a.jsx)(d.A,{className:"w-16 h-16 text-white"}),gradient:"from-purple-500 to-indigo-600",type:"question",question:{id:"time_consuming",text:"Was kostet Sie aktuell am meisten Zeit im Pflegealltag?",type:"checkbox",options:["Beh\xf6rdeng\xe4nge / Antr\xe4ge","Medikamenten-Management","Suche nach Hilfe / Informationen","Organisatorisches (z. B. Termine, Familie + Pflege unter einen Hut zu bekommen)","Die Pflege selbst"],required:!0}},{id:10,title:"Unterst\xfctzung",description:"Welche Hilfe w\xfcnschen Sie sich?",icon:(0,a.jsx)(c.A,{className:"w-16 h-16 text-white"}),gradient:"from-pink-500 to-rose-600",type:"question",question:{id:"support_wanted",text:"Welche Unterst\xfctzung w\xfcrden Sie sich am meisten w\xfcnschen?",type:"checkbox",options:["Klare Informationen & Struktur","Pers\xf6nliche Ansprechpartner (telefonisch/digital)","Pers\xf6nliche Hilfe bei Antragstellung & B\xfcrokratie","Unterst\xfctzung bei Medikamentenmanagement","Hilfe bei Organisation & Entlastungsangeboten","Beratung bei der Suche nach passenden Einrichtungen"],required:!0}},{id:11,title:"Digitale Unterst\xfctzung",description:"Wie k\xf6nnen wir Sie digital unterst\xfctzen?",icon:(0,a.jsx)(d.A,{className:"w-16 h-16 text-white"}),gradient:"from-blue-500 to-cyan-600",type:"question",question:{id:"digital_support",text:"F\xfcr welche Themen w\xfcrden Sie am ehesten digitale Unterst\xfctzung nutzen?",type:"checkbox",options:["Erste pflegerische Einsch\xe4tzung und Pflegeplanung f\xfcr zu Hause","Digitale Pflegeakte (\xdcberblick \xfcber alle Daten wie Diagnosen, Medikamente, wann Rezepte nachbestellt werden m\xfcssen, etc.)","Medikamenten-Check / Risikoanalyse","Beratung, Coaching + Tipps f\xfcr pflegende Angeh\xf6rige","Matching mit passenden Angeboten (Tagespflege, Kurzzeitpflege, etc.)","Finanzielle & rechtliche Fragen"],required:!0}},{id:12,title:"Emotionale Belastung",description:"Wie geht es Ihnen emotional?",icon:(0,a.jsx)(o.A,{className:"w-16 h-16 text-white"}),gradient:"from-green-500 to-emerald-600",type:"question",question:{id:"overwhelmed",text:"F\xfchlen Sie sich mit der aktuellen Pflegesituation allein gelassen / \xfcberfordert?",type:"radio",options:["Ja","Nein","Teilweise"],required:!0}},{id:13,title:"Kostenlose Pflegegrad‑Einsch\xe4tzung",description:"Geben Sie Ihre E‑Mail-Adresse an und wir senden Ihnen kostenlos eine erste Einsch\xe4tzung Ihres m\xf6glichen Pflegegrads. Kein Spam — nur hilfreiche Informationen und Ihre Ergebnisse.",icon:(0,a.jsx)(d.A,{className:"w-16 h-16 text-white"}),gradient:"from-indigo-500 to-purple-600",type:"question",question:{id:"contact_email",text:"Ihre E‑Mail (wir senden die Einsch\xe4tzung an diese Adresse)",type:"text",required:!0}}],f=e=>{let{onComplete:t}=e,[s,o]=(0,n.useState)(0),[c,d]=(0,n.useState)(0),[u,f]=(0,n.useState)(!1),[w,v]=(0,n.useState)({}),[y,b]=(0,n.useState)(!1),j=x[s],N="web"!==r.Capacitor.getPlatform(),C=50,k=e=>{d(e>s?1:-1),o(e)},S=()=>{f(!0)},A=()=>{u&&t(w)},E=(e,t)=>{v(s=>({...s,[e]:t}))},_=()=>{if("intro"===j.type)return!0;if("question"===j.type&&j.question){let e=j.question;if(!e.required)return!0;let t=w[e.id];if("checkbox"===e.type)return Array.isArray(t)&&t.length>0;if("text"===e.type){if("contact_email"===e.id){let e="string"==typeof t?t.trim():"";return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}return"string"==typeof t&&""!==t.trim()}return t&&""!==t}return!1},P=(e,t)=>({email:t.trim(),who_care_for:Array.isArray(e.who_care_for)?e.who_care_for:[],care_duration:e.care_duration||"",care_level:e.care_level||"",hours_per_week:e.hours_per_week||"",stress_level:e.stress_level||"",time_consuming:Array.isArray(e.time_consuming)?e.time_consuming:[],support_wanted:Array.isArray(e.support_wanted)?e.support_wanted:[],digital_support:Array.isArray(e.digital_support)?e.digital_support:[],overwhelmed:e.overwhelmed||""}),I=async e=>{let t=void 0!==g&&"https://navicarenow-backend.api.datafortress.cloud"||window.NEXT_PUBLIC_BACKEND_URL||"",s=t?String(t).trim().replace(/\/+$/,""):"",a="https://navicarenow-backend.api.datafortress.cloud",n=s||a,r="".concat(n,"/questionnaire/submit"),i=P(w,e);if(!n)return{success:!1,error:"Backend URL not set"};try{let e=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!e.ok){let t=await e.json().catch(()=>({})),s=(null==t?void 0:t.error)||e.statusText||"Server error";throw Error(s)}let t=await e.json();return p.Ay.success("Danke — wir haben Ihre Angaben erhalten."),{success:!0,data:t}}catch(t){console.error("Failed to submit questionnaire to backend",t);let e=t instanceof Error?t.message:String(t);return p.Ay.error("Server konnte die Anfrage nicht speichern: "+e),{success:!1,error:e}}},D=async()=>{if(s<x.length-1){_()&&k(s+1);return}if(!_())return;let e=w.contact_email||"";if(e){b(!0);try{await I(e);try{localStorage.setItem("questionnaireResponses",JSON.stringify(w))}catch(e){}try{t(w)}catch(e){}}finally{b(!1),f(!0),window.location.href="/app?mode=register&email=".concat(encodeURIComponent(e))}return}S()},T=()=>{s>0&&k(s-1)},U=()=>{S()},L=(e,t)=>{if(u)return;let a=t.offset.x,n=t.velocity.x;a<-C||n<-500?s<x.length-1&&_()&&k(s+1):(a>C||n>500)&&s>0&&k(s-1)},M={enter:e=>({x:e>0?300:-300,opacity:0}),center:{zIndex:1,x:0,opacity:1},exit:e=>({zIndex:0,x:e<0?300:-300,opacity:0})},R=()=>(0,a.jsx)(i.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:N?.5:.65,duration:N?.6:.8},className:"space-y-6 mb-8 max-w-md mx-auto",children:j.benefits&&(0,a.jsx)("div",{className:"space-y-4",children:j.benefits.map((e,t)=>(0,a.jsxs)(i.P.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:(N?.6:.8)+.1*t,duration:N?.4:.55},className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-gradient-to-r ".concat(j.gradient," flex items-center justify-center shadow-md"),children:(0,a.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})}),(0,a.jsx)("span",{className:"text-white/90 font-medium",children:e})]},t))})}),z=()=>{if(!j.question)return null;let e=j.question;return(0,a.jsx)(i.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:N?.5:.65,duration:N?.6:.8},className:"space-y-6 mb-8 max-w-md mx-auto",children:(0,a.jsxs)(i.P.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},transition:{delay:N?.6:.8,duration:N?.4:.55},className:"space-y-4",children:[(0,a.jsxs)("label",{className:"block text-white/90 font-medium text-base",children:[e.text,e.required&&(0,a.jsx)("span",{className:"text-red-300 ml-1",children:"*"})]}),"radio"===e.type&&e.options&&(0,a.jsx)("div",{className:"space-y-3",children:e.options.map((t,s)=>(0,a.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg hover:bg-white/10 transition-colors",children:[(0,a.jsx)("input",{type:"radio",name:e.id,value:t,checked:w[e.id]===t,onChange:t=>E(e.id,t.target.value),className:"w-5 h-5 text-blue-600 bg-white border-2 border-white/30 focus:ring-blue-500 focus:ring-2 shrink-0 flex-none"}),(0,a.jsx)("span",{className:"text-white/90 text-sm",children:t})]},s))}),"checkbox"===e.type&&e.options&&(0,a.jsx)("div",{className:"space-y-3",children:e.options.map((t,s)=>(0,a.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer p-3 rounded-lg hover:bg-white/10 transition-colors",children:[(0,a.jsx)("input",{type:"checkbox",name:e.id,value:t,checked:Array.isArray(w[e.id])&&w[e.id].includes(t),onChange:s=>{let a=Array.isArray(w[e.id])?w[e.id]:[];s.target.checked?E(e.id,[...a,t]):E(e.id,a.filter(e=>e!==t))},className:"w-5 h-5 text-blue-600 bg-white border-2 border-white/30 focus:ring-blue-500 focus:ring-2 rounded shrink-0 flex-none"}),(0,a.jsx)("span",{className:"text-white/90 text-sm",children:t})]},s))}),"text"===e.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"contact_email"===e.id?"email":"text",inputMode:"contact_email"===e.id?"email":void 0,value:w[e.id]||"",onChange:t=>E(e.id,t.target.value),className:"w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white/50",placeholder:"contact_email"===e.id?"name@beispiel.de":"Ihre Antwort..."}),"contact_email"===e.id&&(0,a.jsx)("p",{className:"text-xs text-white/80 mt-2",children:"Wir senden Ihnen die kostenlose Pflegegrad‑Einsch\xe4tzung an diese Adresse. Kein Spam — nur hilfreiche Informationen und Ihre Ergebnisse."})]})]})})};return(0,a.jsxs)(i.P.div,{className:"fixed inset-0 bg-gradient-to-br from-orange-500 via-red-500 to-pink-600 flex flex-col z-30 overflow-hidden",style:{paddingTop:"calc(env(safe-area-inset-top, 1.5rem))"},initial:{opacity:1},animate:{opacity:+!u},transition:{duration:.5},onAnimationComplete:A,children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-6",children:[(0,a.jsx)("div",{className:"flex space-x-2",children:x.map((e,t)=>(0,a.jsx)("button",{onClick:()=>!u&&k(t),disabled:u,className:"w-8 h-2 rounded-full transition-all duration-300 ".concat(t===s?"bg-white scale-110":t<s?"bg-white/60":"bg-white/30"," disabled:opacity-50"),"aria-label":"Go to step ".concat(t+1)},t))}),s<x.length-1&&(0,a.jsx)("button",{onClick:U,disabled:u,className:"text-white/80 hover:text-white transition-colors text-sm font-medium disabled:opacity-50",children:"Skip"})]}),(0,a.jsx)("div",{className:"flex-1 relative overflow-hidden",children:(0,a.jsx)(l.N,{initial:!1,custom:c,mode:"wait",children:(0,a.jsxs)(i.P.div,{custom:c,variants:M,initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:30},opacity:{duration:.2}},drag:"x",dragConstraints:{left:0,right:0},dragElastic:.3,onDragEnd:L,className:"absolute inset-0 flex flex-col items-center justify-center text-center px-8",children:[(0,a.jsx)(i.P.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:N?.2:.35,duration:N?.6:.8,ease:"easeOut"},className:"w-24 h-24 rounded-full bg-gradient-to-r ".concat(j.gradient," flex items-center justify-center mb-6 shadow-2xl"),children:j.icon}),(0,a.jsx)(i.P.h2,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:N?.3:.45,duration:N?.6:.8},className:"text-2xl font-bold text-white mb-2",children:j.title}),(0,a.jsx)(i.P.p,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:N?.4:.55,duration:N?.6:.8},className:"text-base text-white/90 mb-6 max-w-sm leading-relaxed",children:j.description}),"intro"===j.type?R():z()]},s)})}),(0,a.jsxs)("div",{className:"p-6 flex justify-between items-center",children:[(0,a.jsxs)("button",{onClick:T,disabled:0===s||u,className:"flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-all ".concat(0===s||u?"text-white/40 cursor-not-allowed":"text-white/80 hover:text-white hover:bg-white/10"),children:[(0,a.jsx)(m.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"Back"})]}),(0,a.jsxs)(i.P.button,{onClick:D,disabled:u||!_(),className:"flex items-center space-x-2 px-6 py-3 rounded-lg font-medium transition-all shadow-lg ".concat(s===x.length-1?"bg-orange-600 hover:bg-orange-700 text-white":"bg-white text-orange-600 hover:bg-orange-50"," disabled:opacity-50"),whileTap:{scale:.95},children:[(0,a.jsx)("span",{children:s===x.length-1?"Ergebnisse erhalten & registrieren":"Weiter"}),(0,a.jsx)(h.A,{className:"w-5 h-5"})]})]})]})},w=e=>{let{children:t,questionnaireResponses:s,onQuestionnaireResponsesChange:r}=e,[i,l]=(0,n.useState)(!1),[o,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(s);(0,n.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("onboardingCompleted"),t="true"===e;l(t)}catch(e){console.error("Error during app initialization:",e),l(!1)}finally{c(!0)}})()},[]);let m=async e=>{try{localStorage.setItem("onboardingCompleted","true"),e&&(u(e),localStorage.setItem("questionnaireResponses",JSON.stringify(e)),r&&r(e)),l(!0)}catch(e){console.error("Failed to save onboarding status:",e)}};return o?i?(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsx)(f,{onComplete:m}):null};var v=s(3589);let y=()=>{let[e,t]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let e=!0;return(async()=>{try{await v.S.hide()}catch(e){}let s=setTimeout(()=>{e&&t(!1)},2e3);return()=>clearTimeout(s)})(),()=>{e=!1}},[]),{showSplash:e}};var b=s(3941),j=s(5704);let N={api:{url:(r.Capacitor.isNativePlatform(),j.env.NEXT_PUBLIC_PRODUCTION_URL),timeout:1e4,secret:j.env.NEXT_PUBLIC_API_KEY||""},firebase:{apiKey:j.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:j.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:j.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:j.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:j.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:j.env.NEXT_PUBLIC_FIREBASE_APP_ID,measurementId:j.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID},notifications:{telegram:{apiKey:j.env.NEXT_PUBLIC_TELEGRAM_API_KEY,chatId:j.env.NEXT_PUBLIC_TELEGRAM_CHAT_ID,apiUrl:j.env.NEXT_PUBLIC_TELEGRAM_API_URL}},revenuecat:{apiKey:j.env.NEXT_PUBLIC_REVENUECAT_API_KEY,apiKeyGoogle:j.env.NEXT_PUBLIC_REVENUECAT_API_KEY_GOOGLE,lifetimeProductId:j.env.NEXT_PUBLIC_REVENUECAT_LIFETIME_PRODUCT_ID,monthlyProductId:j.env.NEXT_PUBLIC_REVENUECAT_MONTHLY_PRODUCT_ID,annuallyProductId:j.env.NEXT_PUBLIC_REVENUECAT_ANNUALLY_PRODUCT_ID,weeklyProductId:j.env.NEXT_PUBLIC_REVENUECAT_WEEKLY_PRODUCT_ID,googleGroupId:j.env.NEXT_PUBLIC_REVENUECAT_GOOGLE_GROUP_ID,googleWeeklyProductId:j.env.NEXT_PUBLIC_REVENUECAT_GOOGLE_WEEKLY_PRODUCT_ID,googleMonthlyProductId:j.env.NEXT_PUBLIC_REVENUECAT_GOOGLE_MONTHLY_PRODUCT_ID,googleLifetimeProductId:j.env.NEXT_PUBLIC_REVENUECAT_GOOGLE_LIFETIME_PRODUCT_ID,googleAnnuallyProductId:j.env.NEXT_PUBLIC_REVENUECAT_GOOGLE_ANNUALLY_PRODUCT_ID},openai:{apiKey:j.env.OPENAI_API_KEY},app:{name:"NavicareNow",version:j.env.npm_package_version||"2.0.0",environment:"production"}};var C=s(1004);let k=(0,n.createContext)(null),S=async e=>{if(!e)throw Error("User ID is required");if(await C.P.setLogLevel({level:C.E$.DEBUG}),"ios"===r.Capacitor.getPlatform()){if(!N.revenuecat.apiKey)return;await C.P.configure({apiKey:N.revenuecat.apiKey||"",appUserID:e})}else if("android"===r.Capacitor.getPlatform()){if(!N.revenuecat.apiKeyGoogle)return;await C.P.configure({apiKey:N.revenuecat.apiKeyGoogle||"",appUserID:e})}},A=async()=>await C.P.restorePurchases(),E=e=>{switch(e){case"weekly":return N.revenuecat.weeklyProductId||"";case"monthly":return N.revenuecat.monthlyProductId||"";case"annually":return N.revenuecat.annuallyProductId||"";case"lifetime":return N.revenuecat.lifetimeProductId||"";default:throw Error("Unsupported product type: ".concat(e))}},_=async e=>{let t="";if("ios"===r.Capacitor.getPlatform()?t=E(e):"android"===r.Capacitor.getPlatform()&&(t=N.revenuecat.googleGroupId||""),!t)throw Error("Product identifier is not configured");let{products:s}=await C.P.getProducts({productIdentifiers:[t]});if(!s.length)throw Error("No product found for ".concat(e));if("android"===r.Capacitor.getPlatform()){let t="";switch(e){case"weekly":t=N.revenuecat.googleWeeklyProductId||"";break;case"annually":t=N.revenuecat.googleAnnuallyProductId||"";break;case"monthly":t=N.revenuecat.googleMonthlyProductId||"";break;case"lifetime":t=N.revenuecat.googleLifetimeProductId||"";break;default:throw Error("Unsupported product type: ".concat(e))}if(!t)throw Error("Product ID for ".concat(e," is not configured for Android"));let a=s.find(e=>e.identifier===t);if(!a)throw Error("No product found for ".concat(e," in Android"));return a}return s[0]},P=async e=>{let t=await _(e),s=await C.P.purchaseStoreProduct({product:t});return{success:s.customerInfo.allPurchasedProductIdentifiers.length>0,customerInfo:s.customerInfo}},I=e=>{let{userId:t,children:s}=e,[i,l]=(0,n.useState)(!1),[o,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(null),[m,h]=(0,n.useState)(null),[p,g]=(0,n.useState)(!1),[x,f]=(0,n.useState)([]),[w,v]=(0,n.useState)(null);(0,n.useEffect)(()=>{let e=async()=>{try{c(!0),await S(t);let e=await C.P.getCustomerInfo();u(e),g(e.customerInfo.activeSubscriptions.length>0);let s=N.revenuecat.weeklyProductId,a=N.revenuecat.annuallyProductId,n=N.revenuecat.googleGroupId,i=[""];if("ios"===r.Capacitor.getPlatform()){if(!s||!a)throw Error("RevenueCat product IDs are not configured for iOS");i=[s,a]}else if("android"===r.Capacitor.getPlatform()){if(!n)throw Error("RevenueCat Google group ID is not configured for Android");i=[n]}let{products:o}=await C.P.getProducts({productIdentifiers:i});f(o);let d=o.find(e=>e.identifier===s),m=o.find(e=>e.identifier===a);d&&m&&v({weekly:{price:d.price.toString(),priceString:d.priceString},annually:{price:m.price.toString(),priceString:m.priceString}}),l(!0)}catch(e){h(e instanceof Error?e:Error("Unknown init error"))}finally{c(!1)}};t&&!i&&e()},[t]);let y=async e=>{try{c(!0);let t=await P(e);return u(t.customerInfo),g(t.success),t}catch(e){throw h(e instanceof Error?e:Error("Unknown purchase error")),e}finally{c(!1)}},b=async()=>{try{c(!0);let e=await A();return u(e),g(e.customerInfo.activeSubscriptions.length>0),e}catch(e){throw h(e instanceof Error?e:Error("Unknown restore error")),e}finally{c(!1)}};return(0,a.jsx)(k.Provider,{value:{isInitialized:i,isLoading:o,customerInfo:d,error:m,isPro:p,purchase:y,restore:b,products:x,pricing:w},children:s})};var D=s(4544);let T={user:null,session:null,loading:!0},U=()=>{let[e,t]=(0,n.useState)(T);return(0,n.useEffect)(()=>{let e=!0;(async()=>{try{var s,a,n;let{data:r,error:i}=await b.N.auth.getSession();if(!e)return;if(i){console.warn("Failed to load Supabase session",i),t({user:null,session:null,loading:!1});return}t({user:null!=(a=null==(s=r.session)?void 0:s.user)?a:null,session:null!=(n=r.session)?n:null,loading:!1}),r.session||(0,D.clearCachedToken)()}catch(s){if(!e)return;console.warn("Unexpected Supabase session error",s),t({user:null,session:null,loading:!1})}})();let{data:{subscription:s}}=b.N.auth.onAuthStateChange((s,a)=>{var n;e&&(t({user:null!=(n=null==a?void 0:a.user)?n:null,session:null!=a?a:null,loading:!1}),a||(0,D.clearCachedToken)())});return()=>{e=!1,s.unsubscribe()}},[]),e};var L=s(4375),M=s(1333),R=s(2338),z=s(6888),B=s(5239);let O={src:"/_next/static/media/logo.4409b696.png",height:1715,width:1988,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAHCAMAAAACh/xsAAAALVBMVEVQeT5cfU1MaXFtmmNZh01rl151n2p3oGthi05tmmKEq3psnWFikFSCqnqAp3UGr8lHAAAAD3RSTlMZDABFEcCMyCjZni9YXpfen7UaAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAM0lEQVR4nAXBiQGAMAwDsbOdpA+w/7pIWN+9salZvdaIOd3dZ3iSN8lG5Y0lBKWisAHsHyKjAOBN9P7qAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:7};function q(){let[e,t]=(0,n.useState)(0);(0,n.useEffect)(()=>{let e=setInterval(()=>{t(t=>t>=100?(clearInterval(e),100):t+15*Math.random()+5)},200);return()=>clearInterval(e)},[]);let s="web"!==r.Capacitor.getPlatform();return(0,a.jsxs)(i.P.div,{initial:{opacity:1},animate:{opacity:0},transition:{duration:s?.5:.8,delay:s?1.5:1.8},className:"fixed inset-0 pointer-events-none overflow-hidden bg-gradient-to-br from-blue-600 via-blue-700 to-indigo-800 flex flex-col items-center justify-center z-50",children:[(0,a.jsxs)("div",{className:"absolute inset-0 opacity-10",children:[(0,a.jsx)("div",{className:"absolute top-1/4 left-1/4 w-32 h-32 bg-white rounded-full blur-3xl"}),(0,a.jsx)("div",{className:"absolute bottom-1/4 right-1/4 w-24 h-24 bg-white rounded-full blur-2xl"}),(0,a.jsx)("div",{className:"absolute top-3/4 left-1/3 w-16 h-16 bg-white rounded-full blur-xl"})]}),(0,a.jsxs)("div",{className:"relative z-10 flex flex-col items-center",children:[(0,a.jsx)(i.P.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.8,ease:"easeOut"},className:"mb-8",children:(0,a.jsx)("div",{className:"bg-white p-6 rounded-3xl shadow-2xl flex items-center justify-center",children:(0,a.jsx)(B.default,{src:O,alt:"DocumentChat logo",width:56,height:56})})}),(0,a.jsxs)(i.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,duration:.6},className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-white mb-2",children:"NavicareNow"}),(0,a.jsx)("p",{className:"text-blue-100 text-lg",children:"Ihre digitale Unterst\xfctzung f\xfcr eine bessere Pflegeversorgung"})]}),(0,a.jsxs)(i.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.6,duration:.6},className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"w-64 h-1 bg-blue-400/30 rounded-full mb-4 overflow-hidden",children:(0,a.jsx)(i.P.div,{className:"h-full bg-white rounded-full",initial:{width:0},animate:{width:"".concat(e,"%")},transition:{duration:.3}})}),(0,a.jsx)(i.P.p,{className:"text-blue-100 text-sm",animate:{opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0},children:"Loading amazing features..."})]}),(0,a.jsx)(i.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:1,duration:.6},className:"flex flex-wrap justify-center gap-2 mt-8 max-w-xs",children:["Cross-Platform","Fast","Native","Modern"].map((e,t)=>(0,a.jsx)(i.P.span,{initial:{scale:0},animate:{scale:1},transition:{delay:1.2+.1*t},className:"px-3 py-1 bg-white/20 rounded-full text-white text-xs font-medium",children:e},e))})]}),(0,a.jsx)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(6)].map((e,t)=>(0,a.jsx)(i.P.div,{className:"absolute w-2 h-2 bg-white/20 rounded-full",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%")},animate:{y:[-20,20,-20],opacity:[.2,.8,.2]},transition:{duration:3+2*Math.random(),repeat:1/0,delay:2*Math.random()}},t))})]})}let W=(0,n.createContext)(null),F=()=>{let e=(0,n.useContext)(W);if(!e)throw Error("useToast must be used within ToastProvider");return e},H=e=>{let{children:t}=e,[s,r]=(0,n.useState)([]),i=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",s=String(Date.now())+Math.random().toString(36).slice(2,6),a={id:s,message:e,type:t};r(e=>[a,...e]),setTimeout(()=>{r(e=>e.filter(e=>e.id!==s))},4500)},[]);return(0,a.jsxs)(W.Provider,{value:{show:i},children:[t,(0,a.jsx)("div",{className:"fixed bottom-6 right-4 z-50 flex flex-col gap-2",children:s.map(e=>(0,a.jsx)("div",{className:"px-4 py-2 rounded-lg shadow-md text-sm text-white ".concat("success"===e.type?"bg-green-500":"error"===e.type?"bg-red-500":"bg-blue-500"),children:e.message},e.id))})]})};class G{static async saveResponses(e,t,s){try{let a={email:t,questionnaire:e,user_agent:null==s?void 0:s.user_agent,ip_address:null==s?void 0:s.ip_address},n="https://navicarenow-backend.api.datafortress.cloud";if(!n)return{success:!1,error:"Backend URL not configured"};let r=await fetch("".concat(n,"/questionnaire/submit"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),i=await r.json();if(!r.ok)return console.error("Error saving questionnaire responses:",i.error),{success:!1,error:i.error};return{success:!0,data:i.data}}catch(e){return console.error("Unexpected error saving questionnaire responses:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error occurred"}}}static async getUserResponses(e){try{let{data:t,error:s}=await b.N.from("questionnaire_responses").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(1).single();if(s){if("PGRST116"===s.code)return{success:!0,data:void 0};return console.error("Error fetching user responses:",s),{success:!1,error:s.message}}return{success:!0,data:t}}catch(e){return console.error("Unexpected error fetching user responses:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error occurred"}}}static async updateResponses(e,t,s){try{let a={who_care_for:Array.isArray(t.who_care_for)?t.who_care_for:void 0,care_duration:"string"==typeof t.care_duration?t.care_duration:void 0,care_level:"string"==typeof t.care_level?t.care_level:void 0,hours_per_week:"string"==typeof t.hours_per_week?t.hours_per_week:void 0,stress_level:"string"==typeof t.stress_level?t.stress_level:void 0,time_consuming:Array.isArray(t.time_consuming)?t.time_consuming:void 0,support_wanted:Array.isArray(t.support_wanted)?t.support_wanted:void 0,support_preference:Array.isArray(t.support_preference)?t.support_preference:void 0,personal_contact:"string"==typeof t.personal_contact?t.personal_contact:void 0,digital_support:Array.isArray(t.digital_support)?t.digital_support:void 0,payment_willingness:"string"==typeof t.payment_willingness?t.payment_willingness:void 0,overwhelmed:"string"==typeof t.overwhelmed?t.overwhelmed:void 0,informed_about_rights:"string"==typeof t.informed_about_rights?t.informed_about_rights:void 0,dominant_feelings:Array.isArray(t.dominant_feelings)?t.dominant_feelings:void 0,completed_at:new Date().toISOString(),ip_address:null==s?void 0:s.ip_address,user_agent:null==s?void 0:s.user_agent},{data:n,error:r}=await b.N.from("questionnaire_responses").update(a).eq("id",e).select().single();if(r)return console.error("Error updating questionnaire responses:",r),{success:!1,error:r.message};return{success:!0,data:n}}catch(e){return console.error("Unexpected error updating questionnaire responses:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error occurred"}}}static async getAnalytics(){try{let{data:e,error:t}=await b.N.from("questionnaire_analytics").select("*").order("month",{ascending:!1});if(t)return console.error("Error fetching analytics:",t),{success:!1,error:t.message};return{success:!0,data:e}}catch(e){return console.error("Unexpected error fetching analytics:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error occurred"}}}}var K=s(2090),V=s.n(K);let X=function(){let{questionnaireResponses:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=async t=>{if(e&&0!==Object.keys(e).length)try{let s=await G.saveResponses(e,t,{user_agent:window.navigator.userAgent});s.success?(console.log("Questionnaire responses saved successfully"),p.Ay.success("Ihre Antworten wurden gespeichert")):(console.error("Failed to save questionnaire responses:",s.error),p.Ay.error("Fehler beim Speichern Ihrer Antworten"))}catch(e){console.error("Error saving questionnaire responses:",e),p.Ay.error("Fehler beim Speichern Ihrer Antworten")}},s=(0,z.zy)(),[r,l]=(0,n.useState)(void 0),[o,c]=(0,n.useState)("register");(0,n.useEffect)(()=>{if(s)try{let e=new URLSearchParams(s.search),t=e.get("email"),a=e.get("mode");t&&l(t),("register"===a||"signin"===a)&&c(a)}catch(e){}},[s]);let d=()=>{(0,p.Ay)("Sie werden zur Befragung weitergeleitet — hier k\xf6nnen Sie Ihre Antworten bearbeiten.");try{window.localStorage&&localStorage.setItem("onboardingCompleted","false")}catch(e){console.warn("Failed to set onboarding flag",e)}window.location.href="/app"};return(0,a.jsx)(M.AO,{children:(0,a.jsx)(M.W9,{className:"bg-gradient-to-br from-blue-500 via-blue-600 to-blue-700 ".concat(V().className),children:(0,a.jsx)(i.P.div,{initial:{opacity:0},animate:{opacity:1},className:"min-h-full grid place-items-center p-6",children:(0,a.jsx)("div",{className:"w-full max-w-md",children:(0,a.jsxs)(i.P.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1,duration:.5},className:"flex flex-col items-center justify-center bg-white/10 backdrop-blur-md rounded-3xl p-6 sm:p-10 shadow-2xl space-y-6",children:[(0,a.jsx)(i.P.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5},className:"drop-shadow-lg",children:(0,a.jsx)(B.default,{src:O,alt:"App Logo",width:96,height:96,className:"h-20 w-20 sm:h-24 sm:w-24"})}),(0,a.jsxs)("div",{className:"space-y-2 text-center",children:[(0,a.jsx)(i.P.h1,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,duration:.5},className:"text-white text-3xl font-bold",children:"Ihre pers\xf6nliche Pflegeanalyse"}),(0,a.jsxs)(i.P.p,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.4,duration:.5},className:"text-white/90 font-medium",children:["Registrieren Sie sich, um Ihre individuellen Ergebnisse und Empfehlungen zu erhalten.",r&&(0,a.jsxs)("span",{className:"block text-sm text-white/80 mt-2",children:["Wir haben Ihre kostenlose Pflegegrad‑Einsch\xe4tzung an"," ",(0,a.jsx)("strong",{children:r})," gesendet. Erstellen Sie jetzt ein Konto, um interaktiv Ihre Pflegeakte zu verwalten, Empfehlungen umzusetzen, Dokumente sicher zu speichern und pers\xf6nliche Begleitung zu erhalten."]})]})]}),(0,a.jsxs)(i.P.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5,duration:.5},className:"w-full space-y-4",children:[(0,a.jsxs)("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-4 space-y-3",children:[(0,a.jsx)("h3",{className:"text-white font-semibold text-sm",children:"Nach der Registrierung erhalten Sie:"}),(0,a.jsxs)("ul",{className:"space-y-2 text-xs text-white/90",children:[(0,a.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),(0,a.jsx)("span",{children:"Pers\xf6nliche Pflegebedarfsanalyse"})]}),(0,a.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),(0,a.jsx)("span",{children:"Individuelle Empfehlungen f\xfcr Ihre Situation"})]}),(0,a.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),(0,a.jsx)("span",{children:"Kontakt zu passenden Pflegeeinrichtungen"})]}),(0,a.jsxs)("li",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),(0,a.jsx)("span",{children:"Pers\xf6nliche Begleitung durch unsere Experten"})]})]})]}),(0,a.jsx)(Y,{onAuthSuccess:t}),(0,a.jsx)(Z,{onAuthSuccess:t,onRestartQuestionnaire:d,initialEmail:r,initialMode:o}),(0,a.jsx)("div",{className:"pt-2 text-center",children:(0,a.jsx)("button",{type:"button",onClick:d,className:"btn btn-ghost btn-sm text-xs",children:"Fragebogen neu starten"})})]}),(0,a.jsxs)(i.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.6,duration:.5},className:"text-white/80 text-center text-xs",children:["By signing in, you agree to our"," ",(0,a.jsx)("a",{href:"https://document-chat.com/terms-conditions/",className:"link link-hover text-blue-200 underline",target:"_blank",rel:"noopener noreferrer",children:"Terms"})," ","and"," ",(0,a.jsx)("a",{href:"https://document-chat.com/privacy-policy/",className:"link link-hover text-blue-200 underline",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]})]})})})})})};function J(e){let{setLoading:t,provider:s,onAuthSuccess:n}=e,i=(0,M.jq)(),l=async()=>{t(!0);try{(0,D.clearCachedToken)();let{data:e,error:t}=await b.N.auth.signInWithOAuth({provider:s,options:{redirectTo:"".concat(window.location.origin,"/app"),skipBrowserRedirect:r.Capacitor.isNativePlatform()}});if(t)throw t;if(r.Capacitor.isNativePlatform())if(null==e?void 0:e.url){if((0,p.Ay)("Continue the sign-in flow in the browser window that just opened.",{position:"bottom-center",duration:6e3}),"function"==typeof window.open)try{window.open(e.url,"_blank")}catch(e){console.warn("Unable to open OAuth URL",e)}}else(0,p.Ay)("OAuth sign-in is configured. Follow the instructions in your browser to finish logging in.",{position:"bottom-center",duration:6e3});else if(!(null==e?void 0:e.url)){let{data:{user:e}}=await b.N.auth.getUser();e&&n&&n(e.id),i.push("/app","root","replace")}}catch(t){let e=t instanceof Error?t.message:"OAuth sign-in failed";p.Ay.error(e)}finally{t(!1)}},o="google"===s?"Continue with Google":"Continue with Apple",c={google:"bg-base-100 text-base-content hover:bg-base-200",apple:"bg-black text-white hover:bg-gray-900"};return(0,a.jsxs)("button",{onClick:l,className:"flex items-center justify-center gap-3 rounded-xl ".concat(c[s]," w-full py-3.5 font-medium shadow-lg transition duration-300 transform hover:translate-y-[-2px]"),children:["google"===s?(0,a.jsx)(B.default,{src:"/google.png",alt:"Google Icon",width:20,height:20}):(0,a.jsx)(Q,{}),o]})}function Y(e){let{onAuthSuccess:t}=e,[s,l]=(0,n.useState)(!1);return(r.Capacitor.getPlatform(),s)?(0,a.jsx)("div",{className:"flex justify-center py-4",children:(0,a.jsx)(i.P.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},className:"w-8 h-8 border-4 border-blue-200 border-t-blue-500 rounded-full"})}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(J,{setLoading:l,provider:"google",onAuthSuccess:t})})}function Z(e){let{onAuthSuccess:t,initialEmail:s,initialMode:r,onRestartQuestionnaire:i}=e,[l,o]=(0,n.useState)(null!=r?r:"signin"),[c,d]=(0,n.useState)(s||""),[u,m]=(0,n.useState)(""),[h,g]=(0,n.useState)(!1),x=(0,M.jq)(),f=async e=>{if(null==e||e.preventDefault(),!c.trim()||!u.trim())return void p.Ay.error("Please provide both email and password");g(!0);try{if((0,D.clearCachedToken)(),"signin"===l){let{error:e}=await b.N.auth.signInWithPassword({email:c.trim(),password:u});if(e)throw e;p.Ay.success("Signed in")}else{let{data:e,error:t}=await b.N.auth.signUp({email:c.trim(),password:u});if(t)throw t;if(!e.session){p.Ay.success("Check your email to confirm your account"),o("signin");return}p.Ay.success("Account created")}let{data:{user:e}}=await b.N.auth.getUser();if(e&&t){try{let t=localStorage.getItem("questionnaireResponses"),s=t?JSON.parse(t):void 0;s&&Object.keys(s).length>0&&await G.saveResponses(s,e.id,{user_agent:window.navigator.userAgent})}catch(e){}t(e.id)}x.push("/app","root","replace")}catch(e){console.error("Email auth error",e),p.Ay.error((null==e?void 0:e.message)||String(e))}finally{g(!1)}},w=async()=>{if(!c.trim())return void(0,p.Ay)("Please enter your email to reset password");g(!0);try{let{error:e}=await b.N.auth.resetPasswordForEmail(c.trim(),{redirectTo:"".concat(window.location.origin,"/app")});if(e)throw e;p.Ay.success("Password reset email sent")}catch(e){console.error("Reset password error",e),p.Ay.error((null==e?void 0:e.message)||String(e))}finally{g(!1)}};return(0,a.jsxs)("form",{onSubmit:f,className:"bg-base-200/50 p-4 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"text-sm text-white",children:"signin"===l?"Sign in with email":"Register with email"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:["signin"===l&&(0,a.jsx)("button",{type:"button",onClick:w,className:"text-xs text-blue-200",children:"Forgot password?"}),(0,a.jsx)("button",{type:"button",onClick:()=>o("signin"===l?"register":"signin"),className:"text-xs text-blue-200",children:"signin"===l?"Create account":"Have an account?"})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("input",{value:c,onChange:e=>d(e.target.value),placeholder:"Email",type:"email",className:"input input-bordered w-full bg-base-100 text-base-content placeholder:text-base-content/60"}),(0,a.jsx)("input",{value:u,onChange:e=>m(e.target.value),placeholder:"Password",type:"password",className:"input input-bordered w-full bg-base-100 text-base-content placeholder:text-base-content/60"}),(0,a.jsx)("button",{disabled:h,type:"submit",className:"btn btn-primary btn-block",children:h?"Working...":"signin"===l?"Sign in":"Register"}),"register"===l&&(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)("button",{type:"button",onClick:()=>i&&i(),className:"btn btn-outline btn-block",children:"Fragebogen neu starten"})})]})]})}function Q(){return(0,a.jsxs)("svg",{fill:"currentColor",height:"20px",width:"20px",version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 22.773 22.773",children:[(0,a.jsx)("g",{id:"SVGRepo_bgCarrier",strokeWidth:"0"}),(0,a.jsx)("g",{id:"SVGRepo_tracerCarrier",strokeLinecap:"round",strokeLinejoin:"round"}),(0,a.jsx)("g",{id:"SVGRepo_iconCarrier",children:(0,a.jsx)("g",{children:(0,a.jsxs)("g",{children:[(0,a.jsx)("path",{d:"M15.769,0c0.053,0,0.106,0,0.162,0c0.13,1.606-0.483,2.806-1.228,3.675c-0.731,0.863-1.732,1.7-3.351,1.573 c-0.108-1.583,0.506-2.694,1.25-3.561C13.292,0.879,14.557,0.16,15.769,0z"}),(0,a.jsx)("path",{d:"M20.67,16.716c0,0.016,0,0.03,0,0.045c-0.455,1.378-1.104,2.559-1.896,3.655c-0.723,0.995-1.609,2.334-3.191,2.334 c-1.367,0-2.275-0.879-3.676-0.903c-1.482-0.024-2.297,0.735-3.652,0.926c-0.155,0-0.31,0-0.462,0 c-0.995-0.144-1.798-0.932-2.383-1.642c-1.725-2.098-3.058-4.808-3.306-8.276c0-0.34,0-0.679,0-1.019 c0.105-2.482,1.311-4.5,2.914-5.478c0.846-0.52,2.009-0.963,3.304-0.765c0.555,0.086,1.122,0.276,1.619,0.464 c0.471,0.181,1.06,0.502,1.618,0.485c0.378-0.011,0.754-0.208,1.135-0.347c1.116-0.403,2.21-0.865,3.652-0.648 c1.733,0.262,2.963,1.032,3.723,2.22c-1.466,0.933-2.625,2.339-2.427,4.74C17.818,14.688,19.086,15.964,20.67,16.716z"})]})})})]})}var $=s(8623),ee=s(3063);function et(){let e=(0,n.useRef)(null),[t,s]=(0,n.useState)(!1);function a(){var t;null==(t=e.current)||t.present(),s(!0)}function r(){var t;null==(t=e.current)||t.dismiss(),s(!1)}return{modalRef:e,isOpen:t,open:a,close:r}}let es=function(e){let{title:t,modalRef:s,presentingElement:n,children:r,left:i,right:l}=e;return(0,a.jsx)(M.Sb,{ref:s,presentingElement:n||void 0,children:(0,a.jsxs)("div",{className:"h-full",children:[(i||l||t)&&(0,a.jsxs)(M.eU,{children:[(i||l)&&(0,a.jsxs)(M.ai,{children:[i&&(0,a.jsx)(M.QW,{slot:"start",children:i}),l&&(0,a.jsx)(M.QW,{slot:"end",children:l})]}),t&&(0,a.jsx)(M.ai,{children:(0,a.jsx)(M.BC,{className:"w-full text-center",children:t})})]}),(0,a.jsx)(M.W9,{children:(0,a.jsx)("div",{className:"mt-4",children:r})})]})})};function ea(e){let{children:t,pageRef:s,header:n,collapse:l,toolbarClassName:o=""}=e,c="web"!==r.Capacitor.getPlatform();return(0,a.jsxs)(M.AO,{ref:s,className:"bg-base-100 text-base-content",children:[n&&(0,a.jsx)(M.eU,{collapse:"ios"===r.Capacitor.getPlatform()?l:void 0,children:(0,a.jsx)(M.ai,{className:o,children:n})}),(0,a.jsx)(M.W9,{className:"ion-padding bg-base-100 text-base-content",children:(0,a.jsx)(i.P.div,{initial:{opacity:.995,scale:.98},animate:{opacity:1,scale:1},transition:{duration:c?.25:.45},children:t})})]})}var en=s(7041);function er(e){let{doc:t,presentingElement:s,onClose:r,onDelete:l}=e,{modalRef:o,open:c,close:d}=et();n.useEffect(()=>{t?c():d()},[t]);let u=t?t.filename||t.name||String(t.id||""):"",m=t?t.zoomed_in_url||t.cover_url||t.previewUrl||t.url:null,h=t&&(t.url||t.download_url||m)||"",p=t?String(t.content||t.summary||t.excerpt||u):"";return(0,a.jsx)(es,{title:u?u.length>32?u.slice(0,32)+"…":u:"Preview",modalRef:o,presentingElement:s,left:(0,a.jsx)("button",{onClick:r,children:"Close"}),right:(0,a.jsxs)("div",{className:"flex gap-2",children:[t&&(t.url||t.download_url)?(0,a.jsx)("a",{href:t.url||t.download_url,download:!0,target:"_blank",rel:"noopener noreferrer",className:"btn btn-ghost btn-sm",title:"Download document",children:"Download"}):null,t?(0,a.jsx)("button",{className:"btn btn-ghost text-error btn-sm",onClick:()=>l&&t&&l(t),title:"Delete document",children:"Delete"}):null]}),children:t?(0,a.jsxs)("div",{className:"p-4",children:[m?(0,a.jsx)("a",{href:h,download:!0,target:"_blank",rel:"noopener noreferrer",title:"Download document","aria-label":"Open ".concat(u," in new tab"),className:"block",children:(0,a.jsxs)("div",{className:"relative w-full h-96",children:[(0,a.jsx)(i.P.img,{src:m,alt:u,className:"w-full h-full object-contain cursor-pointer",initial:{scale:.98,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.98,opacity:0},transition:{duration:.22}}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-end",children:(0,a.jsx)("div",{className:"w-full p-3",children:(0,a.jsxs)("div",{className:"bg-black bg-opacity-60 text-white rounded-md p-2",children:[(0,a.jsx)("div",{className:"text-sm font-semibold truncate",children:u}),(0,a.jsx)("div",{className:"mt-1 text-xs leading-tight",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:p})]})})})]})}):(0,a.jsx)("div",{className:"w-full h-96 bg-base-300 flex items-center justify-center text-base-content",children:(0,a.jsx)("div",{className:"p-3 w-full",children:(0,a.jsxs)("div",{className:"bg-black bg-opacity-60 text-white rounded-md p-2 mx-auto max-w-full",children:[(0,a.jsx)("div",{className:"text-sm font-semibold truncate",children:u}),(0,a.jsx)("div",{className:"mt-1 text-xs leading-tight",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:p})]})})}),(0,a.jsx)("div",{className:"mt-3 text-sm text-gray-300",children:(0,a.jsx)(en.oz,{children:p})})]}):null})}var ei=s(838);let el=s(5704).env.NEXT_PUBLIC_DOCUMENT_CHAT_API_BASE||"",eo=el?/^https?:\/\//i.test(el)?el:"https://".concat(el):"";function ec(){if(!eo)throw Error("DocumentChat API base is not configured. Set NEXT_PUBLIC_DOCUMENT_CHAT_API_BASE to your backend URL (for example http://localhost:8000)")}async function ed(e){if((e.headers.get("content-type")||"").includes("text/html")){let t=await e.text();throw Error("Server returned HTML instead of JSON. This usually means NEXT_PUBLIC_DOCUMENT_CHAT_API_BASE is missing or incorrect. Response snippet: ".concat(t.slice(0,200)))}return e.json()}let eu=null;function em(e){return e?{Authorization:"Bearer ".concat(e)}:{}}async function eh(e){if(e)return e;if(eu)try{return await eu()}catch(e){return console.warn("tokenProvider failed",e),null}try{let{default:e}=s(4544);return await e()}catch(e){return null}}let ep={createProject:async function(e,t){ec();let s=await eh(t),a="".concat(eo,"/fullapi/").concat(encodeURIComponent(e)),n=await fetch(a,{method:"POST",headers:{...em(s),"Content-Type":"application/json"},body:JSON.stringify({name:e})});if(!n.ok)throw Error("createProject failed: ".concat(n.status));return ed(n)},uploadDocuments:async function(e,t,s,a){ec();let n=await eh(a),r="".concat(eo,"/fullapi/").concat(encodeURIComponent(e),"/upload"),i=new FormData;t.forEach(e=>i.append("files",e)),void 0!==s&&i.append("highresmode",s.toString());let l=await fetch(r,{method:"POST",headers:{...em(n)},body:i});if(!l.ok)throw Error("uploadDocuments failed: ".concat(l.status));return ed(l)},listDocuments:async function(e,t){ec();let s=await eh(t),a="".concat(eo,"/fullapi/").concat(encodeURIComponent(e),"/documents"),n=await fetch(a,{headers:{...em(s)}});if(!n.ok)throw Error("listDocuments failed: ".concat(n.status));return ed(n)},deleteDocument:async function(e,t,s){ec();let a=await eh(s),n="".concat(eo,"/fullapi/").concat(encodeURIComponent(e),"/documents/").concat(encodeURIComponent(String(t)));try{console.debug("[documentChatApi] DELETE",n,{projectName:e,documentId:t})}catch(e){}let r=await fetch(n,{method:"DELETE",headers:{...em(a)}});if(!r.ok)throw Error("deleteDocument failed: ".concat(r.status));return ed(r)},deleteChat:async function(e,t,s){ec();let a=await eh(s),n="".concat(eo,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(String(t)));try{console.debug("[documentChatApi] DELETE CHAT",n,{projectName:e,chatId:t})}catch(e){}let r=await fetch(n,{method:"DELETE",headers:{...em(a)}});if(!r.ok)throw Error("deleteChat failed: ".concat(r.status));return ed(r)},deleteProjectApi:async function(e,t){ec();let s=await eh(t),a="".concat(eo,"/fullapi/").concat(encodeURIComponent(e));try{console.debug("[documentChatApi] DELETE PROJECT",a,{projectName:e})}catch(e){}let n=await fetch(a,{method:"DELETE",headers:{...em(s)}});if(!n.ok)throw Error("deleteProject failed: ".concat(n.status));return ed(n)},createChatByName:async function(e,t,s){ec();let a=await eh(s),n="".concat(eo,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(t));try{console.debug("[documentChatApi] CREATE CHAT BY NAME",n,{projectName:e,chatName:t})}catch(e){}let r=await fetch(n,{method:"POST",headers:{...em(a),"Content-Type":"application/json"},body:""});if(!r.ok)throw Error("createChatByName failed: ".concat(r.status));return ed(r)},getChatByProject:async function(e,t,s){ec();let a=await eh(s),n="".concat(eo,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(String(t))),r=await fetch(n,{headers:{...em(a)}});if(!r.ok)throw Error("getChatByProject failed: ".concat(r.status));return ed(r)},addMessage:async function(e,t,s,a){ec();let n=await eh(a),r="".concat(eo,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(String(t)),"/message"),i=await fetch(r,{method:"PUT",headers:{...em(n),"Content-Type":"application/json"},body:JSON.stringify({message:s,persona:"user"})});if(!i.ok)throw Error("addMessage failed: ".concat(i.status));return ed(i)},listProjects:async function(e){ec();let t=await eh(e),s="".concat(eo,"/fullapi"),a=await fetch(s,{headers:{...em(t)}});if(!a.ok)throw Error("listProjects failed: ".concat(a.status));return ed(a)},listChats:async function(e,t){ec();let s=await eh(t),a="".concat(eo,"/fullapi/").concat(encodeURIComponent(e),"/chats"),n=await fetch(a,{headers:{...em(s)}});if(!n.ok)throw Error("listChats failed: ".concat(n.status));return ed(n)},renameChat:async function(e,t,s,a){ec();let n=await eh(a),r="".concat(eo,"/fullapi/").concat(encodeURIComponent(e),"/chats/").concat(encodeURIComponent(String(t)),"/rename"),i=new URLSearchParams({new_name:s}).toString(),l=await fetch(r,{method:"PUT",headers:{...em(n),Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},body:i});if(!l.ok)throw Error("renameChat failed: ".concat(l.status));return ed(l)},setTokenProvider:function(e){eu=e},clearTokenProvider:function(){eu=null},quicksearchDocuments:async function(e,t,s){ec();let a=await eh(s),n="".concat(eo,"/fullapi/").concat(encodeURIComponent(e),"/quicksearch/").concat(encodeURIComponent(t)),r=await fetch(n,{headers:{...em(a)}});if(!r.ok)throw Error("quicksearchDocuments failed: ".concat(r.status));return ed(r)}};var eg=s(3630),ex=s(2614),ef=s(1165),ew=s(6615),ev=s(4979),ey=s(8527),eb=s(2036),ej=s(5704);let eN=20,eC=e=>{if(/^\d{1,2}:\d{2}$/.test(e))return e;try{let t=new Date(e);if(!isNaN(t.getTime()))return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(e){}return e||"00:00"},ek=e=>[{id:"welcome",text:"Hey, I know everything about the documents you uploaded in this project - feel free to ask me any questions about them :).",sender:"other",time:new Date().toISOString(),status:"read"}],eS="Hey, I know everything about the documents you uploaded in this project - feel free to ask me any questions about them :).";function eA(e){let{chatId:t}=e,[s,r]=(0,n.useState)(""),[i,l]=(0,n.useState)([]),[o,c]=(0,n.useState)([]),[d,u]=(0,n.useState)(!0),[m,h]=(0,n.useState)(!1),[p,g]=(0,n.useState)(!1),[x,f]=(0,n.useState)(!1),{session:w}=U(),v=(0,n.useRef)(null),y=(0,n.useRef)(null),b=(0,n.useRef)(null),j=(0,n.useRef)(null);(0,n.useRef)(null),(0,n.useEffect)(()=>{if(!w)return void ep.clearTokenProvider();try{ep.setTokenProvider(async()=>await (0,D.default)(w))}catch(e){console.warn("Failed to register token provider",e)}return()=>{try{ep.clearTokenProvider()}catch(e){console.warn("Failed to clear token provider",e)}}},[w]);let[N,C]=(0,n.useState)("IDLE"),[k,S]=(0,n.useState)(void 0);(0,n.useEffect)(()=>{f("PENDING"===N)},[N]);let A=F(),[E,_]=(0,n.useState)(null),[P,I]=(0,n.useState)(null),{modalRef:T,open:L,close:R}=et(),[z,B]=(0,n.useState)(""),[O,q]=(0,n.useState)(null),[W,H]=(0,n.useState)(""),[G,K]=(0,n.useState)(1),[V,X]=(0,n.useState)(!0),[J,Y]=(0,n.useState)(!0),[Z,Q]=(0,n.useState)(!1),[$,ee]=(0,n.useState)(0),{modalRef:el,open:eo,close:ec}=et(),[ed,eu]=(0,n.useState)(null),{modalRef:em,open:eh,close:ey}=et(),[eb,eC]=(0,n.useState)(null),[eA,eP]=(0,n.useState)(!1),eI=!0,eD=/here is (the )?answer( (from|based on) )? ?your documents/i,eT=(0,n.useRef)([]),[eU,eL]=(0,n.useState)(0),[eM,eR]=(0,n.useState)(!1),ez=(0,n.useCallback)((e,t)=>{if(eI)try{let s=(()=>{if(void 0===t)return"";if("string"==typeof t)return t;try{return JSON.stringify(t,(e,t)=>"function"==typeof t?"[function]":t,2)}catch(e){try{return String(t)}catch(e){return"[unserializable]"}}})(),a="".concat(new Date().toISOString()," [").concat(e,"] ").concat(s);eT.current.push(a),eT.current.length>200&&eT.current.shift(),eL(e=>e+1),console.log("[DBG]",e,t)}catch(t){console.log("[DBG] failed to record",e,t)}},[]),eB=(0,n.useCallback)((e,t)=>{if(eI)try{console.debug("[mergeMessages] local:",e,"incoming:",t)}catch(e){}let s=new Map;for(let t of e)s.set(t.id,{...t,time:t.time||new Date().toISOString()});for(let e of t){let t={...e,time:e.time||new Date().toISOString(),status:e.status||"read"},a=(t.text||"").trim(),n=eD.test(a);if(n){let e=new Set((t.sourceDocuments||[]).map(e=>String(e.id)));if(Array.from(s.values()).some(t=>{let s=(t.text||"").trim();if(s.length>Math.max(32,a.length+20))return!0;let n=new Set((t.sourceDocuments||[]).map(e=>String(e.id)));if(n.size>0&&e.size>0){let t=0;for(let s of e)n.has(s)&&t++;if(t>0&&s.length>=a.length)return!0;let r=!0;for(let t of e)if(!n.has(t)){r=!1;break}if(r&&s.length>=a.length)return!0}return!1})){ez("mergeMessages.skipPlaceholder",{incomingId:t.id,reason:"found richer/overlapping existing message"});continue}}if(n){ez("mergeMessages.skipPermanentPlaceholder",{incomingId:t.id,text:a});continue}if("me"===t.sender){for(let[e,n]of s.entries())if("me"===n.sender&&["sending","sent","delivered"].includes(n.status||"")&&(n.text||"").trim()===a){ez("mergeMessages.replaceOptimistic",{tempId:e,serverId:t.id}),s.delete(e);break}}s.set(t.id,t)}let a=Array.from(s.values()).map((e,t)=>{let s=e.time,a=t;if(s){let e=Date.parse(s);if(Number.isNaN(e)){let e=s.match(/^(\d{1,2}):(\d{2})$/);if(e){let s=new Date;s.setHours(Number(e[1])),s.setMinutes(Number(e[2])),s.setSeconds(0),s.setMilliseconds(t),a=s.getTime()}}else a=e}return{message:e,sortKey:a}});return a.sort((e,t)=>e.sortKey-t.sortKey),a.map(e=>e.message)},[]),eO=(0,n.useCallback)(()=>{setTimeout(()=>{b.current&&b.current.scrollIntoView({behavior:"smooth"})},350)},[b]),eq=async()=>{if(!eb)return;eP(!0);let e=eb;try{if("chats"===e.type){let s=e.id?[e.id]:[t];try{for(let e of s)await ep.deleteChat(String(k||"default"),e)}catch(e){console.error("Error deleting chats on server:",e),null==A||A.show("Could not delete chat(s). Please try again.","error");return}try{let e=(await ei.Ay.loadChats()||[]).filter(e=>!s.includes(e.id));await ei.Ay.saveChats(e);let t=s.map(e=>ei.Ay.deleteChatMessages(e));await Promise.all(t),null==A||A.show("Chat deleted","success")}catch(e){console.error("Error cleaning up local chat storage:",e),null==A||A.show("Chat deleted on server but local cleanup failed","info")}try{window&&window.history&&window.history.length>1?window.history.back():window.location.href="/app/chats"}catch(e){}return}if("document"===e.type){let t=e.extra;if(!t)return;try{let e=String(k||"default");await ep.deleteDocument(e,t.id)}catch(e){console.warn("deleteDocument API failed",e)}try{let e=(await ei.Ay.loadDocuments()||[]).filter(e=>e.id!==t.id);await ei.Ay.saveDocuments(e);try{window.dispatchEvent(new CustomEvent("documents-updated",{detail:{projectId:k||"default",documents:e}}))}catch(e){}}catch(e){console.error("Error removing document from storage",e)}l(e=>e.map(e=>e.sourceDocuments&&Array.isArray(e.sourceDocuments)?{...e,sourceDocuments:e.sourceDocuments.filter(e=>e.id!==t.id)}:e)),c(e=>e.map(e=>e.sourceDocuments&&Array.isArray(e.sourceDocuments)?{...e,sourceDocuments:e.sourceDocuments.filter(e=>e.id!==t.id)}:e));try{ec()}catch(e){}eu(null),null==A||A.show("Document deleted","success");try{let e=String(k||"default"),t=await ep.listDocuments(e);if(Array.isArray(t)){let e=(t||[]).map(e=>({id:e.id||e.filename||String(Date.now()),projectId:k||"default",name:e.filename||e.name||e.id,mimeType:e.filetype||e.mimeType,url:e.url||e.source||e.signed_url,previewUrl:e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl,size:e.size,uploadedAt:e.uploaded_at||e.created_at||new Date().toISOString()}));try{await ei.Ay.saveDocuments(e);try{window.dispatchEvent(new CustomEvent("documents-updated",{detail:{projectId:k||"default",documents:e}}))}catch(e){}}catch(e){console.warn("Could not save refreshed documents locally",e)}}}catch(e){}}}finally{eP(!1),eC(null);try{ey()}catch(e){}}},eW=()=>{eO()};(0,n.useEffect)(()=>{let e=()=>{let e=y.current;e&&Q(e.scrollHeight-e.scrollTop-e.clientHeight>500)},t=y.current;if(t)return t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)},[]),(0,n.useEffect)(()=>{_(v.current)},[]),(0,n.useEffect)(()=>{!async function(){try{u(!0);let e=(await ei.Ay.loadChats()).find(e=>e.id===t);e&&(I({name:e.name}),e.projectId&&S(e.projectId));let s=await ei.Ay.getMessageCount(t);if(ee(s),0===s){let e=ek(t);await ei.Ay.saveChatMessages(t,e),l(e),c(e),X(!1)}else{let a=(await ei.Ay.loadChatMessagesPaginated(t,1,eN)).map(e=>({...e,time:e.time||new Date().toISOString()}));c(a),X(s>eN);let n=(await ei.Ay.loadChatMessages(t)).map(e=>({...e,time:e.time||new Date().toISOString()}));l(n);try{let s=null,a=(null==e?void 0:e.projectId)||"default";try{s=await ep.getChatByProject(a,t),eI&&(console.debug("[loadChatData] chatFromApi:",s),ez("loadChatData.chatFromApi",s))}catch(e){throw console.warn("getChatByProject failed for",a,e),e}if(s&&(s.processing_state||s.messages)){let e=N,t=s.processing_state||"IDLE";if(C(t),"PENDING"===e&&"DONE"===t?null==A||A.show("Processing finished","success"):"PENDING"===e&&"ERROR"===t&&(null==A||A.show("Processing failed","error")),Array.isArray(s.messages)&&s.messages.length>0){let e=s.messages.map(e=>({id:e.id||String(Date.now()),text:e.message||e.text||"",sender:"assistant"===e.persona||"bot"===e.persona?"other":"me",time:e.created_at||new Date().toISOString(),status:"read",...Array.isArray(e.documents)&&e.documents.length>0?{sourceDocuments:e.documents}:{}}));eI&&(console.debug("[loadChatData] mapped messages from API:",e),ez("loadChatData.mapped",e)),l(t=>{let s=t.filter(e=>"welcome"!==e.id&&(e.text||"").trim()!==eS);return eB(s,e)}),c(t=>{let s=t.filter(e=>"welcome"!==e.id&&(e.text||"").trim()!==eS);return eB(s,e).slice(-eN)})}}}catch(e){console.warn("Could not fetch chat from API",e)}}}catch(s){console.error("Error loading chat data:",s);let e=ek(t);l(e),c(e),X(!1)}finally{u(!1),Y(!1)}}()},[t]),(0,n.useEffect)(()=>{if(!J&&!m&&o.length>0){var e;let t=o[o.length-1];t&&("me"===t.sender||(null==(e=i[i.length-1])?void 0:e.id)===t.id)&&eO()}},[o,J,m,i,eO]),(0,n.useEffect)(()=>{!d&&i.length>0&&ei.Ay.saveChatMessages(t,i).catch(e=>{console.error("Error saving messages:",e)})},[i,d,t]);let eF=(0,n.useCallback)(async()=>{if(m||!V)return Promise.resolve(!1);try{h(!0);let e=G+1,s=y.current,a=(null==s?void 0:s.scrollHeight)||0,n=(null==s?void 0:s.scrollTop)||0,r=await ei.Ay.loadChatMessagesPaginated(t,e,eN);if(!(r.length>0))return X(!1),Promise.resolve(!1);{c(e=>[...r,...e]),K(e);let t=e*eN;return X($>t),new Promise(e=>{setTimeout(()=>{if(s){let e=s.scrollHeight-a;s.scrollTop=n+e}e(!0)},10)})}}catch(e){return console.error("Error loading more messages:",e),Promise.resolve(!1)}finally{h(!1)}},[t,G,V,m,$]);(0,n.useEffect)(()=>{let e=null,t=()=>{let t=y.current;t&&t.scrollTop<50&&V&&!m&&(e&&clearTimeout(e),e=setTimeout(()=>{eF().catch(e=>{console.error("Error in auto-load more:",e)})},200))},s=y.current;if(s)return s.addEventListener("scroll",t),()=>{s.removeEventListener("scroll",t),e&&clearTimeout(e)}},[V,m,eF]);let eH=()=>{eF().catch(e=>{console.error("Error loading more messages:",e)})};(0,n.useEffect)(()=>{let e=null,s=async()=>{w&&(e=setInterval(async()=>{try{let e=await (0,D.default)(w);if(!e)return;let s=null,a=k||"default";try{s=await ep.getChatByProject(a,t,e),eI&&(console.debug("[poll] chatFromApi:",s),ez("poll.chatFromApi",s))}catch(e){console.warn("Polling getChatByProject failed for",a,e);return}if(!s)return;let n=s.processing_state||"IDLE";if(C(n),Array.isArray(s.messages)&&s.messages.length>0){let e=s.messages.map(e=>({id:e.id||String(Date.now()),text:e.message||e.text||"",sender:"assistant"===e.persona||"bot"===e.persona?"other":"me",time:e.created_at||new Date().toISOString(),status:"read",...Array.isArray(e.documents)&&e.documents.length>0?{sourceDocuments:e.documents}:{}}));eI&&(console.debug("[poll] mapped messages:",e),ez("poll.mapped",e)),l(t=>{let s=t.filter(e=>"welcome"!==e.id&&(e.text||"").trim()!==eS);return eB(s,e)}),c(t=>{let s=t.filter(e=>"welcome"!==e.id&&(e.text||"").trim()!==eS);return eB(s,e).slice(-eN)}),ee(t=>Math.max(t,e.length))}}catch(e){console.warn("Polling error",e)}},2e3))};return"PENDING"===N&&s().catch(e=>console.warn(e)),()=>{e&&clearInterval(e)}},[t,N,w]),(0,n.useCallback)(e=>{console.log("Creating automatic response message");let s={id:Date.now().toString(),text:e,sender:"other",time:new Date().toISOString(),status:"read"};console.log("Adding automatic response to messages:",s),l(e=>{let a=[...e,s];return c(e=>[...e,s]),ee(e=>e+1),ei.Ay.saveChatMessages(t,a).then(()=>console.log("Automatic response saved to storage")).catch(e=>console.error("Error saving automatic response:",e)),a}),eJ(e).then(()=>console.log("Chat list updated with automatic response")).catch(e=>console.error("Error updating chat list:",e))},[t]);let eG=async()=>{let e=(z||"").trim();if(e)try{let s=String(k||"default");try{await ep.renameChat(s,t,e)}catch(a){try{let a=ej.env.NEXT_PUBLIC_DOCUMENT_CHAT_API_BASE||"",n="".concat(a,"/fullapi/").concat(encodeURIComponent(s),"/chats/").concat(encodeURIComponent(String(t)),"/rename"),r=await (0,D.default)(w);await fetch(n,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded",...r?{Authorization:"Bearer ".concat(r)}:{}},body:new URLSearchParams({new_name:e}).toString()})}catch(e){console.warn("Rename fallback failed",e)}}try{let s=(await ei.Ay.loadChats()||[]).map(s=>s.id===t?{...s,name:e}:s);await ei.Ay.saveChats(s)}catch(e){console.warn("Could not persist renamed chat locally",e)}I(t=>t?{...t,name:e}:{name:e});try{R()}catch(e){}null==A||A.show("Chat renamed","success")}catch(e){console.error("Rename chat failed",e),null==A||A.show("Could not rename chat","error")}},eK=e=>!!(e.sourceDocuments&&Array.isArray(e.sourceDocuments)&&e.sourceDocuments.length>0),eV=async()=>{if(s.trim()&&!p){g(!0);let n={id:Date.now().toString(),text:s.trim(),sender:"me",time:new Date().toISOString(),status:"sending"};r(""),eI&&(console.debug("[sendMessage] optimistic newMessage:",n),ez("sendMessage.optimistic",n)),l(e=>eB(e,[n])),c(e=>eB(e,[n]).slice(-eN));try{var e,a;let n=(null==(a=await ei.Ay.loadChats())||null==(e=a.find(e=>e.id===t))?void 0:e.projectId)||"default";try{await ep.addMessage(n,t,s.trim())}catch(e){console.warn("api.addMessage failed, falling back to manual PUT",e);try{let e=ej.env.NEXT_PUBLIC_DOCUMENT_CHAT_API_BASE||"",a="".concat(e,"/fullapi/").concat(encodeURIComponent(n),"/chats/").concat(encodeURIComponent(String(t)),"/message"),r=await (0,D.default)(w);await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{}},body:JSON.stringify({message:s.trim(),persona:"user"})})}catch(e){console.warn("Fallback add message failed",e)}}C("PENDING");try{let e=(await ei.Ay.loadChats()||[]).map(e=>e.id===t?{...e,processingState:"PENDING"}:e);await ei.Ay.saveChats(e)}catch(e){console.warn("Could not persist processing state",e)}await eJ(s.trim())}catch(e){console.error("Send message failed",e),l(e=>e.map(e=>e.id===n.id?{...e,status:"failed"}:e)),c(e=>e.map(e=>e.id===n.id?{...e,status:"failed"}:e))}finally{g(!1)}}},eX=e=>{l(t=>t.map(t=>t.id===e?{...t,status:"sending"}:t)),c(t=>t.map(t=>t.id===e?{...t,status:"sending"}:t)),setTimeout(()=>{l(t=>t.map(t=>t.id===e?{...t,status:"sent"}:t)),c(t=>t.map(t=>t.id===e?{...t,status:"sent"}:t)),setTimeout(()=>{l(t=>t.map(t=>t.id===e?{...t,status:"delivered"}:t)),c(t=>t.map(t=>t.id===e?{...t,status:"delivered"}:t))},1e3)},1500)},eJ=async e=>{try{let s=(await ei.Ay.loadChats()||[]).map(s=>s.id===t?{...s,message:e,time:"Just now",isRead:!0}:s);await ei.Ay.saveChats(s)}catch(e){console.error("Error updating chat last message:",e)}},eY=(e,t)=>{q(e),H(t),setTimeout(()=>{j.current&&j.current.focus()},50)},eZ=()=>{q(null),H("")},eQ=async()=>{if(!O||!W.trim())return;l(e=>e.map(e=>e.id===O?{...e,text:W.trim(),isEdited:!0}:e)),c(e=>e.map(e=>e.id===O?{...e,text:W.trim(),isEdited:!0}:e));let e=i[i.length-1];e&&e.id===O&&await eJ(W.trim()+" (edited)"),q(null),H("")},e$=async e=>{l(t=>{let s=t.map(t=>t.id===e?{...t,isDeleted:!0,text:"This message was deleted"}:t),a=t[t.length-1];if(a&&a.id===e){let e=s.filter(e=>!e.isDeleted).pop();e?eJ(e.text):eJ("No messages")}return s}),c(t=>t.map(t=>t.id===e?{...t,isDeleted:!0,text:"This message was deleted"}:t))},e0="PENDING"===N;return(0,a.jsx)(ea,{pageRef:v,header:(0,a.jsx)("div",{className:"navbar bg-base-200 shadow-lg",children:(0,a.jsxs)("div",{className:"w-full grid grid-cols-[min-content_1fr_min-content] items-center gap-2 px-2",children:[(0,a.jsx)("div",{className:"col-start-1 col-end-2",children:(0,a.jsx)(M.QW,{children:(0,a.jsx)(M.el,{defaultHref:"/app/chats",text:"",className:"btn btn-ghost btn-circle btn-sm"})})}),(0,a.jsxs)("div",{className:"col-start-2 col-end-3 overflow-hidden text-center",children:[(0,a.jsx)("h1",{className:"text-lg font-semibold truncate w-full whitespace-nowrap",children:(0,a.jsx)("button",{onClick:()=>{B((null==P?void 0:P.name)||""),L()},className:"text-inherit text-left w-full truncate","aria-label":"Rename chat",children:(null==P?void 0:P.name)||"Loading..."})}),x&&(0,a.jsxs)("div",{className:"text-xs text-primary flex items-center gap-1 justify-center mt-0",children:[(0,a.jsx)("span",{className:"loading loading-dots loading-xs"}),"typing..."]})]}),(0,a.jsx)("div",{className:"col-start-3 col-end-4 justify-self-end",children:(0,a.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm hover:text-error",onClick:()=>{eC({type:"chats",id:t,name:null==P?void 0:P.name}),eh()},title:"Delete chat",children:(0,a.jsx)(eg.A,{size:18})})})]})}),children:(0,a.jsxs)("div",{className:"w-full flex flex-col flex-1 min-h-0 bg-base-100",children:[(0,a.jsx)("div",{ref:y,className:"flex-1 overflow-y-auto px-4 py-6 mb-auto relative min-h-0 pb-32",children:d?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[(0,a.jsx)("span",{className:"loading loading-spinner loading-lg text-primary"}),(0,a.jsx)("p",{className:"text-base-content/60 text-sm",children:"Loading messages..."})]}):0===o.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-3",children:[(0,a.jsx)("div",{className:"text-5xl opacity-20",children:"\uD83D\uDCAC"}),(0,a.jsxs)("p",{className:"text-base-content/60 text-center",children:["No messages yet.",(0,a.jsx)("br",{}),"Start a conversation!"]})]}):(0,a.jsxs)(a.Fragment,{children:[V&&(0,a.jsx)("div",{className:"flex justify-center mb-6",children:m?(0,a.jsxs)("div",{className:"flex items-center gap-2 text-primary",children:[(0,a.jsx)("span",{className:"loading loading-spinner loading-sm"}),(0,a.jsx)("span",{className:"text-sm",children:"Loading older messages..."})]}):(0,a.jsxs)("button",{onClick:eH,className:"btn btn-sm btn-ghost gap-2","aria-label":"Load earlier messages",children:[(0,a.jsx)(ex.A,{size:16}),"Load earlier messages"]})}),o.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsx)(eE,{message:e,chatId:t,onRetry:"failed"===e.status?()=>eX(e.id):void 0,onEdit:"me"===e.sender&&!e.isDeleted&&["sent","delivered","read"].includes(e.status||"")?()=>eY(e.id,e.text):void 0,onDelete:"me"!==e.sender||e.isDeleted?void 0:()=>e$(e.id)},e.id),"other"===e.sender&&eK(e)&&(0,a.jsxs)("div",{className:"mb-4 ml-12",children:[(0,a.jsx)("div",{className:"divider divider-start text-xs opacity-60",children:"Source documents"}),(0,a.jsx)("div",{className:"flex gap-3 overflow-x-auto pb-2 scrollbar-thin",children:e.sourceDocuments.map(e=>(0,a.jsx)("div",{className:"w-36 flex-shrink-0 group",role:"button",tabIndex:0,"aria-label":"Open document ".concat(e.name),onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),eu(e),eo())},onClick:()=>{eu(e),eo()},children:(0,a.jsxs)("div",{className:"card card-compact bg-base-200 shadow-md hover:shadow-lg transition-shadow overflow-hidden cursor-pointer border border-base-300",children:[(0,a.jsxs)("figure",{className:"relative h-24 bg-base-300",children:[e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl?(0,a.jsx)("img",{src:e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl,alt:e.filename||e.name,className:"w-full h-full object-cover"}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center text-base-content/50 text-xs p-2 text-center",children:"\uD83D\uDCC4"}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,a.jsx)("div",{className:"flex items-center justify-center rounded-full w-8 h-8 bg-primary text-white shadow-lg",children:(0,a.jsx)("span",{className:"text-sm",children:"\uD83D\uDD0D"})})})]}),(0,a.jsxs)("div",{className:"card-body",children:[(0,a.jsx)("h3",{className:"card-title text-xs truncate",children:e.filename||e.name}),(0,a.jsx)("div",{className:"line-clamp-2 text-[11px] text-base-content/70",children:(0,a.jsx)(en.oz,{children:String(e.content||e.summary||e.excerpt||e.previewText||"No preview available")})})]})]})},e.id))})]})]},e.id)),e0&&(0,a.jsx)(e_,{}),Z&&(0,a.jsx)("button",{onClick:eW,className:"btn btn-circle btn-primary shadow-xl fixed bottom-28 right-4 z-10","aria-label":"Scroll to bottom",children:(0,a.jsx)(ef.A,{size:20})}),(0,a.jsx)("div",{ref:b})]})}),eM&&(0,a.jsxs)("div",{className:"mockup-code fixed bottom-32 right-4 z-50 max-w-xs max-h-80 overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2 px-4 pt-2",children:[(0,a.jsx)("div",{className:"font-medium",children:"Debug Events"}),(0,a.jsxs)("div",{className:"text-xs opacity-60",children:[eT.current.length," items"]})]}),(0,a.jsx)("div",{className:"space-y-1 px-4 pb-2",children:eT.current.slice().reverse().map((e,t)=>(0,a.jsx)("div",{className:"whitespace-pre-wrap break-words",children:e},t))})]}),(0,a.jsx)(er,{doc:ed,presentingElement:E,onClose:()=>{try{ec()}catch(e){}eu(null)},onDelete:e=>{eC({type:"document",extra:e}),eh()}}),(0,a.jsx)(es,{title:"Rename Chat",modalRef:T,presentingElement:E,left:(0,a.jsx)("button",{className:"btn btn-ghost btn-sm",onClick:()=>{B("");try{R()}catch(e){}},children:"Cancel"}),children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("label",{className:"label",children:[(0,a.jsx)("span",{className:"label-text font-medium",children:"Chat Name"}),(0,a.jsx)("span",{className:"label-text-alt text-base-content/50",children:"Required"})]}),(0,a.jsx)("input",{value:z,onChange:e=>B(e.target.value),placeholder:"Chat name",className:"input input-bordered input-lg w-full",onKeyDown:e=>{"Enter"===e.key&&eG()},autoFocus:!0})]}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)("button",{className:"btn btn-ghost",onClick:()=>{B("");try{R()}catch(e){}},children:"Cancel"}),(0,a.jsx)("button",{className:"btn btn-primary gap-2",onClick:()=>eG(),disabled:!z.trim(),children:"Rename"})]})]})}),(0,a.jsx)(es,{title:"Confirm Delete",modalRef:em,presentingElement:E,left:(0,a.jsx)("button",{onClick:()=>{eC(null),ey()},className:"btn btn-ghost btn-sm",children:"Cancel"}),children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"alert alert-warning mb-6",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-bold",children:"Warning!"}),(0,a.jsx)("div",{className:"text-sm",children:"This action cannot be undone."})]})]}),(0,a.jsxs)("p",{className:"text-base mb-6",children:["Are you sure you want to delete"," ",(0,a.jsx)("strong",{className:"text-error",children:(null==eb?void 0:eb.name)||"this item"}),"?"]}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)("button",{className:"btn btn-ghost",onClick:()=>{eC(null),ey()},disabled:eA,children:"Cancel"}),(0,a.jsx)("button",{className:"btn btn-error gap-2",onClick:()=>eq(),disabled:eA,children:eA?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"loading loading-spinner loading-sm"}),"Deleting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eg.A,{size:16}),"Confirm Delete"]})})]})]})}),(0,a.jsx)("div",{className:"fixed left-0 right-0 bottom-0 bg-base-200 border-t border-base-300 shadow-2xl z-40",children:(0,a.jsx)("div",{className:"p-3 max-w-4xl mx-auto",children:(0,a.jsxs)("div",{className:"join w-full items-center bg-base-100 rounded-box shadow-md border border-base-300",children:[O&&(0,a.jsx)("button",{onClick:eZ,className:"btn btn-ghost btn-circle btn-sm join-item ml-2","aria-label":"Cancel edit",children:(0,a.jsx)(ew.A,{size:18})}),(0,a.jsx)("label",{className:"input input-ghost flex-1 join-item border-0",children:(0,a.jsx)("input",{ref:j,type:"text",value:O?W:s,onChange:e=>O?H(e.target.value):r(e.target.value),placeholder:O?"Edit message...":"Type a question...",className:"grow",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&O&&eZ():(e.preventDefault(),O?eQ():!p&&s.trim()&&eV())},disabled:p&&!O})}),(0,a.jsx)("div",{className:"join-item pr-2",children:O?W.trim()?(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:eQ,className:"btn btn-primary btn-circle btn-sm","aria-label":"Save edit",children:(0,a.jsx)(ev.A,{size:18})})}):(0,a.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm",disabled:!0,children:(0,a.jsx)(ev.A,{size:18})}):!p&&s.trim()?(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:eV,className:"btn btn-primary btn-circle btn-sm","aria-label":"Send message",children:(0,a.jsx)(ev.A,{size:18})})}):(0,a.jsx)("button",{className:"btn btn-ghost btn-circle btn-sm",disabled:!0,children:(0,a.jsx)(ev.A,{size:18})})})]})})})]})})}function eE(e){let{message:t,chatId:s,onRetry:r,onEdit:i,onDelete:l}=e,o="me"===t.sender,[c,d]=(0,n.useState)(!1);return(0,a.jsx)("div",{className:"flex ".concat(o?"justify-end":"justify-start"," mb-4 relative group px-2"),children:(0,a.jsx)("div",{className:"chat ".concat(o?"chat-end":"chat-start"," w-[80vw] max-w-[80vw]"),children:(0,a.jsxs)("div",{className:"chat-bubble ".concat(o?"chat-bubble-primary shadow-md":"bg-base-200 text-base-content shadow-md"," ").concat(t.isDeleted?"opacity-60 italic":""),onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),onTouchStart:()=>d(!0),onTouchEnd:()=>setTimeout(()=>d(!1),3e3),children:[t.isDeleted?(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"opacity-50",children:"\uD83D\uDDD1️"}),t.text]}):(0,a.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,a.jsx)(en.oz,{children:t.text||""})}),(0,a.jsxs)("div",{className:"text-xs opacity-60 mt-2 flex items-center gap-1.5 ".concat(o?"justify-end":"justify-start"),children:[(0,a.jsx)("span",{children:eC(t.time)}),o&&!t.isDeleted&&(0,a.jsxs)(a.Fragment,{children:["sending"===t.status&&(0,a.jsx)("span",{className:"loading loading-spinner loading-xs"}),"sent"===t.status&&(0,a.jsx)(ey.A,{size:12,className:"opacity-50"}),"delivered"===t.status&&(0,a.jsxs)("div",{className:"flex -space-x-1",children:[(0,a.jsx)(ey.A,{size:12,className:"text-info"}),(0,a.jsx)(ey.A,{size:12,className:"text-info"})]}),"read"===t.status&&(0,a.jsxs)("div",{className:"flex -space-x-1",children:[(0,a.jsx)(ey.A,{size:12,className:"text-success"}),(0,a.jsx)(ey.A,{size:12,className:"text-success"})]}),"failed"===t.status&&(0,a.jsx)("button",{onClick:r,className:"badge badge-error badge-xs gap-1",children:"Failed • Retry"})]}),t.isEdited&&!t.isDeleted&&(0,a.jsx)("span",{className:"badge badge-ghost badge-xs",children:"edited"})]}),o&&c&&!t.isDeleted&&(0,a.jsxs)("div",{className:"absolute -top-2 right-0 join join-horizontal shadow-lg",children:[i&&(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),i()},className:"btn btn-xs join-item tooltip tooltip-top","data-tip":"Edit",children:(0,a.jsx)(eb.A,{size:12})}),l&&(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),l()},className:"btn btn-xs join-item btn-error tooltip tooltip-top","data-tip":"Delete",children:(0,a.jsx)(eg.A,{size:12})})]}),!o&&!t.isDeleted&&(0,a.jsx)("div",{className:"mt-2 text-left",children:(0,a.jsx)("a",{className:"link link-primary link-hover text-xs opacity-70",href:"mailto:info@document-chat.com?subject=".concat(encodeURIComponent("Report AI generated content"),"&body=").concat(encodeURIComponent("I want to report an AI-generated message in chat ".concat(s||"",".\n\nMessage ID: ").concat(t.id,"\n\nMessage text:\n").concat(t.text,"\n\nPlease investigate."))),onClick:e=>{},children:"Report AI generated content"})})]})})})}function e_(){return(0,a.jsx)("div",{className:"flex justify-start mb-4 px-2",children:(0,a.jsx)("div",{className:"chat chat-start w-[80vw] max-w-[80vw]",children:(0,a.jsx)("div",{className:"chat-bubble bg-base-200 text-base-content shadow-md",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"loading loading-dots loading-sm"}),(0,a.jsx)("span",{className:"text-xs opacity-60",children:"Assistant is typing"})]})})})})}var eP=s(109);function eI(){let{value:e,onChange:t,placeholder:s="Search"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[r,i]=(0,n.useState)(!1),[l,o]=(0,n.useState)(e||"");(0,n.useEffect)(()=>{void 0!==e&&o(e)},[e]);let c=e=>{let s=e.target.value;o(s),t&&t(s)};return(0,n.useEffect)(()=>{let e=e=>{r&&e.target&&"closest"in e.target&&!e.target.closest("#search-input")&&i(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[r]),(0,a.jsxs)("label",{id:"search-input",className:"flex rounded-lg bg-base-200 dark:bg-base-300 py-2 px-4 items-center gap-2",children:[(0,a.jsx)("div",{children:(0,a.jsx)(eP.A,{size:18,className:"text-base-content/60"})}),(0,a.jsx)("input",{value:l,onChange:c,onClick:()=>i(!0),className:"appearance-none placeholder:text-gray-400 text-lg bg-transparent outline-none",placeholder:s})]})}var eD=s(6140);function eT(e){let{name:t,progress:s,subtitle:n,onCancel:r,onRetry:i,failed:l}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-3 bg-base-200 p-3 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:t}),(0,a.jsxs)("div",{className:"text-xs text-gray-400",children:[s,"%"]})]}),n?(0,a.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:n}):null,(0,a.jsx)("div",{className:"w-full bg-base-300 rounded-full h-2 mt-2 overflow-hidden",children:(0,a.jsx)("div",{className:"h-2 bg-blue-500",style:{width:"".concat(s,"%")}})})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:l?(0,a.jsx)("button",{onClick:i,className:"btn btn-ghost btn-xs",children:(0,a.jsx)(eD.A,{size:16})}):(0,a.jsx)("button",{onClick:r,className:"btn btn-ghost btn-xs",children:(0,a.jsx)(ew.A,{size:16})})})]})}var eU=s(9045);function eL(){var e;let t=(0,n.useRef)(null),[s,r]=(0,n.useState)(null),{modalRef:o,open:c,close:d}=et(),{modalRef:u,open:m,close:h}=et(),{modalRef:p,open:g,close:x}=et();(0,n.useRef)(void 0);let[f,w]=(0,n.useState)(null),[v,y]=(0,n.useState)(!1),[b,j]=(0,n.useState)(null),[N,C]=(0,n.useState)(""),k=(0,M.jq)(),[S,A]=(0,n.useState)([]),[E,_]=(0,n.useState)([]),[P,I]=(0,n.useState)(null),[T,L]=(0,n.useState)([]),{session:R}=U(),[z,B]=(0,n.useState)({}),[O,q]=(0,n.useState)({}),[W,H]=(0,n.useState)({}),[G,K]=(0,n.useState)({}),[V,X]=(0,n.useState)([]),J=F(),[Y,Z]=(0,n.useState)(!0),[Q,$]=(0,n.useState)(!1),[ee,el]=(0,n.useState)(new Set),[eo,ec]=(0,n.useState)("");(0,n.useEffect)(()=>{!async function(){Z(!0);try{var e,t;let s=await ei.Ay.loadChats(),a=await ei.Ay.loadProjects(),n=await ei.Ay.loadDocuments(),r=null;try{let e=await ep.listProjects();if(Array.isArray(e)&&e.length>0){let t=e.map(e=>"string"==typeof e?{id:e,name:e,createdAt:new Date().toISOString()}:{id:e.id||e.name||String(e.name),name:e.name||e.id||String(e.name),createdAt:e.created_at||new Date().toISOString()});r=t,_(t)}}catch(e){console.warn("Could not load projects from backend",e)}let i=r||(a&&a.length>0?a:[{id:"default",name:"default",createdAt:new Date().toISOString()}]);r||_(i);let l=i&&i.find(e=>"default"===e.id)||i&&i[0]||{id:"default",name:"default",createdAt:new Date().toISOString()};I(l);try{let t=String(null!=(e=l.name)?e:l.id),s=await ep.listDocuments(t);if(s&&s.length>0){let e=(s||[]).map(e=>({id:e.id||e.filename||String(Date.now()),projectId:l.id,name:e.filename||e.name||e.id,mimeType:e.filetype||e.mimeType,url:e.url||e.source||e.signed_url,previewUrl:e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl,size:e.size,uploadedAt:e.uploaded_at||e.created_at||new Date().toISOString()}));L(e)}else L(n||[])}catch(e){console.warn("listDocuments failed",e),null==J||J.show("Could not load documents from backend. Using cached documents. (".concat(String((null==e?void 0:e.message)||e),")"),"error"),L(n||[])}try{let e=String(null!=(t=l.name)?t:l.id),a=await ep.listChats(e);if(Array.isArray(a)){let e=(a||[]).map(e=>{var t,s;return{id:String(e.id||e.chat_id||Date.now()),name:e.name||"Chat ".concat(e.id||""),message:(null==(t=e.last_message)?void 0:t.message)||e.lastMessage||"No messages yet",time:(null==(s=e.last_message)?void 0:s.created_at)||e.time||"Just now",image:e.avatar,unreadCount:e.unreadCount,isRead:!!e.isRead,lastMessage:e.lastMessage,lastMessageTime:e.lastMessageTime}});A(e)}else A((s||[]).map(e=>({id:e.id,name:e.name||"Chat",message:e.message||e.lastMessage||"No messages yet",time:e.time||e.lastMessageTime||"Just now",image:e.avatar,unreadCount:e.unreadCount,isRead:!!e.isRead,lastMessage:e.lastMessage,lastMessageTime:e.lastMessageTime})))}catch(e){console.warn("Could not load chats from backend",e),A((s||[]).map(e=>({id:e.id,name:e.name||"Chat",message:e.message||e.lastMessage||"No messages yet",time:e.time||e.lastMessageTime||"Just now",image:e.avatar,unreadCount:e.unreadCount,isRead:!!e.isRead,lastMessage:e.lastMessage,lastMessageTime:e.lastMessageTime})))}}catch(e){console.error("Error loading chats:",e),A([])}finally{Z(!1)}}()},[]),(0,n.useEffect)(()=>{if(!P)return;let e=!0;return(async()=>{try{var t,s;let a=await ep.listDocuments(String(null!=(t=null==P?void 0:P.name)?t:null==P?void 0:P.id));if(e&&Array.isArray(a)&&a.length>0){let e=(a||[]).map(e=>({id:e.id||e.filename||String(Date.now()),projectId:P.id,name:e.filename||e.name||e.id,mimeType:e.filetype||e.mimeType,url:e.url||e.source||e.signed_url,previewUrl:e.cover_url||e.zoomed_in_url||e.cover||e.previewUrl,size:e.size,uploadedAt:e.uploaded_at||e.created_at||new Date().toISOString()}));L(e.concat(T.filter(e=>e.projectId!==P.id)))}let n=await ep.listChats(String(null!=(s=null==P?void 0:P.name)?s:null==P?void 0:P.id));if(e&&Array.isArray(n)){let e=(n||[]).map(e=>{var t,s;return{id:String(e.id||e.chat_id||Date.now()),name:e.name||"Chat ".concat(e.id||""),message:(null==(t=e.last_message)?void 0:t.message)||e.lastMessage||"No messages yet",time:(null==(s=e.last_message)?void 0:s.created_at)||e.time||"Just now"}});A(e)}}catch(e){console.warn("Error refreshing project data",e)}})(),()=>{e=!1}},[P]),(0,n.useEffect)(()=>{if(!R)return void ep.clearTokenProvider();try{ep.setTokenProvider(async()=>await (0,D.default)(R))}catch(e){console.warn("Failed to set token provider",e)}return()=>{try{ep.clearTokenProvider()}catch(e){}}},[R]),(0,n.useEffect)(()=>{Y||(ei.Ay.saveProjects(E).catch(e=>console.error("Error saving projects:",e)),ei.Ay.saveDocuments(T).catch(e=>console.error("Error saving documents:",e)))},[E,T,Y]),(0,n.useEffect)(()=>{!Y&&S.length>0&&ei.Ay.saveChats(S).catch(e=>{console.error("Error saving chats:",e)})},[S,Y]);let ed=N?S.filter(e=>e.name.toLowerCase().includes(N.toLowerCase())):S;(0,n.useEffect)(()=>{r(t.current)},[]),(0,n.useEffect)(()=>{let e=e=>{try{var t;let s=e.detail;if(!s)return;s.projectId===(null!=(t=null==P?void 0:P.id)?t:"default")&&L(s.documents||[])}catch(e){console.warn("documents-updated handler error",e)}};return window.addEventListener("documents-updated",e),()=>window.removeEventListener("documents-updated",e)},[P]);let eu=e=>{el(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})};(0,n.useEffect)(()=>{if(0===V.length)return;let e=[...V],t=setTimeout(()=>{X(t=>t.filter(t=>!e.includes(t))),null==J||J.show("".concat(e.length," file(s) uploaded"),"success")},2e3);return()=>clearTimeout(t)},[V]);let em=async()=>{if(!f)return;y(!0);let e=f;try{var t,s,a,n;if("chats"===e.type){let s=e.id?[e.id]:Array.from(ee);try{for(let e of s)await ep.deleteChat(String(null!=(t=P.name)?t:P.id),e)}catch(e){console.error("Error deleting chats on server:",e),null==J||J.show("Could not delete chats. Please try again.","error");return}let a=new Set(s),n=S.filter(e=>!a.has(e.id));A(n),el(new Set),$(!1);try{let e=s.map(e=>ei.Ay.deleteChatMessages(e));await Promise.all(e),await ei.Ay.saveChats(n),null==J||J.show("Chats deleted","success")}catch(e){console.error("Error cleaning up local chat storage:",e),null==J||J.show("Chats deleted on server but local cleanup failed","info")}}else if("project"===e.type){if(!e.id)return;try{let t=E.find(t=>t.id===e.id),a=String(null!=(s=null==t?void 0:t.name)?s:e.id);await ep.deleteProjectApi(a)}catch(e){console.error("Error deleting project on server:",e),null==J||J.show("Could not delete project. Please try again.","error");return}ef(e.id),null==J||J.show("Project deleted","success")}else if("document"===e.type){let t=e.extra;if(!t)return;if(!P){null==J||J.show("No project selected","error");return}try{await ep.deleteDocument(String(null!=(a=P.name)?a:P.id),t.id),L(e=>e.filter(e=>e.id!==t.id)),null==J||J.show("Document deleted","success");try{h()}catch(e){}j(null);try{let e=(await ep.listDocuments(String(null!=(n=null==P?void 0:P.name)?n:null==P?void 0:P.id))||[]).map(e=>({id:e.id||e.filename||String(Date.now()),projectId:P.id,name:e.filename||e.name||e.id,mimeType:e.filetype||e.mimeType,url:e.url||e.source||e.signed_url,previewUrl:e.cover_url||e.zoomed_in_url||e.cover||e.previewUrl,size:e.size,uploadedAt:e.uploaded_at||e.created_at||new Date().toISOString()}));L(e.concat(T.filter(e=>e.projectId!==P.id)))}catch(e){}}catch(e){console.error("Delete document failed",e),null==J||J.show("Could not delete document. Please try again.","error")}}}finally{y(!1),w(null),x()}},eh=e=>{if(Q)return void eu(e);A(t=>t.map(t=>t.id===e?{...t,isRead:!0,unreadCount:0}:t)),k.push("/app/chats/".concat(e),"forward")},eg=async()=>{d();let e="1";if(S.length>0){let t=Math.max(...S.map(e=>{let t=parseInt(e.id);return isNaN(t)?0:t}));e=(isFinite(t)?t+1:1).toString()}let t={id:e,name:"New Chat ".concat(e),message:"Hey there!",time:"Just now",isRead:!0,lastMessage:"Hey there!",lastMessageTime:"Just now"},s={id:t.id,name:t.name,message:t.message,time:t.time,isRead:t.isRead,lastMessage:t.lastMessage,lastMessageTime:t.lastMessageTime,projectId:(null==P?void 0:P.id)||"default"};A([t,...S]);try{let c=await ei.Ay.loadChats()||[];await ei.Ay.saveChats([s,...c]);let d={id:"1",text:"Hey there! This is a new conversation, but I know everything about the documents you uploaded in this project space, so shoot me some questions :)!",sender:"other",time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),status:"delivered"};await ei.Ay.saveChatMessages(e,[d]);try{var a,n,r,i,l,o;let s=String(null!=(n=null==P?void 0:P.name)?n:null==P?void 0:P.id),c="".concat(t.name||"new chat"," ").concat(new Date().toISOString()),d=await ep.createChatByName(s,c),u=String(null!=(o=null!=(l=null!=(i=null!=(r=null==d?void 0:d.id)?r:null==d?void 0:d.chat_id)?i:null==d||null==(a=d.chat)?void 0:a.id)?l:null==d?void 0:d.chatId)?o:"");if(u){A(t=>t.map(t=>t.id===e?{...t,id:u}:t));try{let t=await ei.Ay.loadChatMessages(e)||[];t.length>0&&(await ei.Ay.saveChatMessages(u,t),await ei.Ay.deleteChatMessages(e));let s=(await ei.Ay.loadChats()||[]).map(t=>String(t.id)===String(e)?{...t,id:u}:t);await ei.Ay.saveChats(s)}catch(e){console.warn("Failed to migrate local chat messages to server id",e)}try{k.push("/app/chats/".concat(u),"forward")}catch(e){console.warn("Navigation to new chat failed",e)}}else k.push("/app/chats/".concat(e),"forward")}catch(t){console.warn("createChat API failed, falling back to local chat:",t);try{k.push("/app/chats/".concat(e),"forward")}catch(e){console.warn("Navigation to new chat failed",e)}}}catch(e){console.error("Error creating new chat:",e)}},ex=async e=>{try{let t=await ep.createProject(e),s=String((null==t?void 0:t.id)||(null==t?void 0:t.name)||Date.now()),a=(null==t?void 0:t.created_at)||(null==t?void 0:t.createdAt)||new Date().toISOString(),n={id:s,name:(null==t?void 0:t.name)||e,createdAt:a};return _(e=>[n,...e]),I(n),null==J||J.show("Project created successfully","success"),n}catch(s){console.warn("createProject backend failed, falling back to local",s);let t={id:Date.now().toString(),name:e,createdAt:new Date().toISOString()};return _(e=>[t,...e]),I(t),null==J||J.show("Project created locally (offline)","info"),t}},ef=async e=>{"default"!==e&&_(t=>{let s=t.filter(t=>t.id!==e);return I(s[0]||{id:"default",name:"default",createdAt:new Date().toISOString()}),s})},ew=async e=>{if(!e||0===e.length||!P)return;let t=Array.from(e);for(let e of(K(e=>{let s={...e};for(let e of t)s[e.name]=e;return s}),t))ev(e).catch(e=>console.error("startUpload failed",e))},ev=async e=>{if(!P)return;if(!R){null==J||J.show("Please sign in again to upload documents.","error");return}let t=e.name;try{var s,a;let n=await (0,D.default)(R);if(!n){null==J||J.show("Session expired. Please sign in again.","error");return}B(e=>({...e,[t]:0})),H(e=>({...e,[t]:!1})),await ep.uploadDocuments(String(null!=(s=null==P?void 0:P.name)?s:null==P?void 0:P.id),[e],!1,n);let r=(await ep.listDocuments(String(null!=(a=null==P?void 0:P.name)?a:null==P?void 0:P.id))||[]).map(e=>({id:e.id||e.filename||String(Date.now()),projectId:P.id,name:e.filename||e.name||e.id,mimeType:e.filetype||e.mimeType,url:e.url||e.source||e.signed_url,previewUrl:e.cover_url||e.zoomed_in_url||e.cover||e.previewUrl,size:e.size,uploadedAt:e.uploaded_at||e.created_at||new Date().toISOString()}));L(r.concat(T.filter(e=>e.projectId!==P.id))),X(e=>[...e,t]),K(e=>{let s={...e};return delete s[t],s})}catch(s){console.error("Upload error:",s),H(e=>({...e,[t]:!0}));let e=String((null==s?void 0:s.message)||s);e.includes("413")||e.toLowerCase().includes("content too large")?null==J||J.show("Upload failed: file too large (server rejected with 413)","error"):e.includes("Failed to fetch")||e.toLowerCase().includes("network")?null==J||J.show("Upload failed: network or CORS error. Check server CORS settings and try again.","error"):null==J||J.show("Upload failed: ".concat(e),"error")}finally{B(e=>{let s={...e};return delete s[t],s}),q(e=>{let s={...e};return delete s[t],s})}};return(0,a.jsx)(ea,{pageRef:t,toolbarClassName:"bg-base-100",header:(0,a.jsx)(M.BC,{size:"large",children:(0,a.jsx)("div",{className:"w-full flex justify-center items-center",children:(0,a.jsx)("img",{src:"/logo.png",alt:"Logo",className:"h-12 sm:h-14 md:h-16 w-auto",style:{display:"block"}})})}),children:(0,a.jsxs)("div",{className:"flex flex-col pb-36 gap-6 pt-4 px-4 max-w-6xl mx-auto w-full",children:[(0,a.jsx)("div",{className:"card bg-gradient-to-br from-primary/5 to-secondary/5 border border-primary/10",children:(0,a.jsxs)("div",{className:"card-body p-4",children:[(0,a.jsx)("div",{className:"flex items-start gap-3 mb-3",children:(0,a.jsxs)("div",{className:"badge badge-primary gap-1",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Quicksearch"]})}),(0,a.jsx)("p",{className:"text-sm text-base-content/70 mb-3",children:"Search all documents in this project instantly. Perfect for finding keywords or specific snippets."}),(0,a.jsx)("form",{onSubmit:async e=>{e.preventDefault(),N.trim()&&P&&k.push("/app/quicksearch?projectName=".concat(encodeURIComponent(P.name),"&query=").concat(encodeURIComponent(N)),"forward")},children:(0,a.jsx)(eI,{value:N,onChange:C,placeholder:"Search documents..."})})]})}),Y?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"card bg-base-200 shadow-lg",children:(0,a.jsxs)("div",{className:"card-body p-6",children:[(0,a.jsx)("div",{className:"skeleton h-6 w-40 mb-4"}),(0,a.jsx)("div",{className:"skeleton h-12 w-full mb-3"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsx)("div",{className:"skeleton h-10 w-full"}),(0,a.jsx)("div",{className:"skeleton h-10 w-full"})]})]})}),(0,a.jsx)("div",{className:"card bg-base-200 shadow-lg",children:(0,a.jsxs)("div",{className:"card-body p-6",children:[(0,a.jsx)("div",{className:"skeleton h-6 w-32 mb-4"}),(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"skeleton h-10 w-36"}),(0,a.jsx)("div",{className:"skeleton h-8 w-20"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:Array.from({length:6}).map((e,t)=>(0,a.jsxs)("div",{className:"card bg-base-300 shadow",children:[(0,a.jsx)("div",{className:"skeleton h-40 w-full"}),(0,a.jsxs)("div",{className:"card-body p-3",children:[(0,a.jsx)("div",{className:"skeleton h-4 w-full mb-2"}),(0,a.jsx)("div",{className:"skeleton h-3 w-3/4"})]})]},t))})]})}),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-3",children:[(0,a.jsx)("span",{className:"loading loading-spinner loading-lg text-primary"}),(0,a.jsx)("p",{className:"text-base-content/60",children:"Loading chats..."})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"card bg-base-200 shadow-lg border border-base-300",children:(0,a.jsxs)("div",{className:"card-body p-6",children:[(0,a.jsxs)("h2",{className:"card-title text-base mb-4 flex items-center gap-2",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),"Current Project"]}),(0,a.jsx)("select",{value:null!=(e=null==P?void 0:P.id)?e:"",onChange:e=>{let t=E.find(t=>t.id===e.target.value);I(t||null),ei.Ay.loadChats().then(e=>{A((e||[]).filter(e=>(e.projectId||"default")===((null==t?void 0:t.id)||"default")).map(e=>({...e,message:e.message||e.lastMessage||"No messages yet",time:e.time||e.lastMessageTime||"Just now"})))})},className:"select select-bordered select-lg w-full mb-4 font-medium",children:0===E.length?(0,a.jsx)("option",{value:"",children:"No projects available"}):E.map(e=>(0,a.jsxs)("option",{value:e.id,children:["\uD83D\uDCC1 ",e.name]},e.id))}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("button",{className:"btn btn-primary gap-2",onClick:()=>{c()},children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Project"]}),(0,a.jsxs)("button",{className:"btn btn-outline btn-error gap-2",onClick:()=>{P&&(w({type:"project",id:P.id,name:P.name}),g())},disabled:!P||"default"===P.id,children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})]})}),(0,a.jsx)("div",{className:"card bg-base-200 shadow-lg border border-base-300",children:(0,a.jsxs)("div",{className:"card-body p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h2",{className:"card-title text-base flex items-center gap-2",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Documents"]}),(0,a.jsxs)("div",{className:"badge badge-primary badge-lg gap-2",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),T.filter(e=>e.projectId===(null==P?void 0:P.id)).length," ","files"]})]}),(0,a.jsxs)("label",{className:"btn btn-primary btn-lg w-full gap-2 mb-4",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Upload Files",(0,a.jsx)("input",{type:"file",multiple:!0,className:"hidden",onChange:e=>ew(e.target.files)})]}),Object.keys({...z,...W}).filter(e=>void 0!==z[e]||W[e]).length>0&&(0,a.jsx)("div",{className:"divider text-xs opacity-60",children:"Active Uploads"}),(0,a.jsx)("div",{className:"flex flex-col gap-2 mb-4",children:Object.keys({...z,...W}).filter(e=>void 0!==z[e]||W[e]).map(e=>{var t;let s=G[e],n=s?s.size:void 0,r=n?n<1024?"".concat(n," B"):n<1048576?"".concat((n/1024).toFixed(1)," KB"):"".concat((n/1048576).toFixed(1)," MB"):void 0;return(0,a.jsx)(eT,{name:e,subtitle:r,progress:null!=(t=z[e])?t:(W[e],0),failed:!!W[e],onCancel:()=>{let t=O[e];t&&t.abort&&t.abort(),H(t=>({...t,[e]:!0}))},onRetry:()=>{let t=G[e];t&&ev(t)}},e)})}),0===T.filter(e=>e.projectId===(null==P?void 0:P.id)).length?(0,a.jsxs)("div",{className:"alert alert-info",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"stroke-current shrink-0 w-6 h-6",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsx)("span",{children:"No documents yet. Upload files to get started!"})]}):(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:(0,a.jsx)(l.N,{children:T.filter(e=>e.projectId===(null==P?void 0:P.id)).map(e=>(0,a.jsx)(i.P.div,{layout:!0,initial:{opacity:0,scale:.98},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.96,transition:{duration:.18}},whileHover:{scale:1.02},whileTap:{scale:.99},transition:{type:"spring",stiffness:300,damping:24},className:"",children:(0,a.jsxs)("div",{className:"card card-compact bg-base-100 shadow-md hover:shadow-xl border border-base-300 transition-all cursor-pointer group overflow-hidden",onClick:()=>{j(e),m()},children:[(0,a.jsxs)("figure",{className:"relative h-36 bg-base-300 overflow-hidden",children:[e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl?(0,a.jsx)("img",{src:e.zoomed_in_url||e.cover_url||e.cover||e.previewUrl,alt:e.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-base-200 to-base-300",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-base-content/30",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 badge badge-primary badge-sm gap-1",children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]})]}),(0,a.jsxs)("div",{className:"card-body p-3",children:[(0,a.jsx)("h3",{className:"card-title text-sm truncate",title:e.filename||e.name,children:e.filename||e.name}),(0,a.jsx)("p",{className:"text-xs text-base-content/70 line-clamp-2",children:(0,a.jsx)(en.oz,{children:String(e.content||e.summary||e.excerpt||"No preview available")})})]})]})},e.id))})})]})}),(0,a.jsx)("div",{className:"card bg-gradient-to-br from-primary/10 to-secondary/10 border-2 border-dashed border-primary/30 hover:border-primary/50 transition-colors",children:(0,a.jsxs)("div",{className:"card-body p-6 items-center text-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-primary mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("h3",{className:"card-title text-lg mb-2",children:"Start a New Conversation"}),(0,a.jsx)("p",{className:"text-sm text-base-content/60 mb-4",children:"Chat with AI about your documents"}),(0,a.jsxs)("button",{className:"btn btn-primary btn-lg gap-2",onClick:()=>eg(),children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Chat"]})]})}),(0,a.jsx)(eM,{chats:ed,onChatClick:eh,isEditing:Q,selectedChats:ee,onDelete:(e,t)=>{w({type:"chats",id:e,name:t||""}),g()}})]}),(0,a.jsx)(es,{title:"Create New Project",modalRef:o,presentingElement:s,left:(0,a.jsx)(M.Jm,{fill:"clear",onClick:()=>{ec(""),d()},children:"Cancel"}),children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("label",{className:"label",children:[(0,a.jsx)("span",{className:"label-text font-medium",children:"Project Name"}),(0,a.jsx)("span",{className:"label-text-alt text-base-content/50",children:"Required"})]}),(0,a.jsx)("input",{value:eo,onChange:e=>ec(e.target.value),placeholder:"My Awesome Project",className:"input input-bordered input-lg w-full",onKeyDown:e=>{"Enter"===e.key&&eo.trim()&&(ex(eo.trim()),ec(""),d())},autoFocus:!0}),(0,a.jsx)("label",{className:"label",children:(0,a.jsx)("span",{className:"label-text-alt text-base-content/60",children:"Choose a descriptive name for your project"})})]}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)("button",{className:"btn btn-ghost",onClick:()=>{ec(""),d()},children:"Cancel"}),(0,a.jsxs)("button",{className:"btn btn-primary gap-2",onClick:()=>{ex(eo.trim()||"New Project"),ec(""),d()},disabled:!eo.trim(),children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Create Project"]})]})]})}),(0,a.jsx)(er,{doc:b,presentingElement:s,onClose:()=>{try{h()}catch(e){}j(null)},onDelete:e=>{w({type:"document",extra:e}),g()}}),(0,a.jsx)(es,{title:"Confirm Delete",modalRef:p,presentingElement:s,left:(0,a.jsx)("button",{className:"btn btn-ghost btn-sm",onClick:()=>{w(null),x()},children:"Cancel"}),children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"alert alert-warning mb-6",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-bold",children:"Warning!"}),(0,a.jsx)("div",{className:"text-sm",children:"This action cannot be undone."})]})]}),(0,a.jsxs)("p",{className:"text-base mb-6",children:["Are you sure you want to delete"," ",(0,a.jsx)("strong",{className:"text-error",children:(null==f?void 0:f.name)||"this item"}),"?"]}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)("button",{className:"btn btn-ghost",onClick:()=>{w(null),x()},disabled:v,children:"Cancel"}),(0,a.jsx)("button",{className:"btn btn-error gap-2",onClick:()=>em(),disabled:v,children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"loading loading-spinner loading-sm"}),"Deleting..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Confirm Delete"]})})]})]})})]})})}function eM(e){let{chats:t,onChatClick:s,isEditing:n,selectedChats:r,onDelete:i}=e;return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"divider text-sm font-semibold",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 inline mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),"Your Conversations"]}),0===t.length?(0,a.jsx)("div",{className:"card bg-base-200 border-2 border-dashed border-base-300",children:(0,a.jsxs)("div",{className:"card-body items-center text-center py-12",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-base-content/30 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No conversations yet"}),(0,a.jsx)("p",{className:"text-sm text-base-content/60",children:"Start a new conversation to chat with AI about your documents"})]})}):(0,a.jsx)("div",{className:"flex flex-col gap-3",children:t.map((e,t)=>(0,a.jsx)(eR,{chat:e,onClick:()=>s(e.id),isEditing:n,selectedChats:r,onDelete:i},e.id))})]})}function eR(e){var t,s;let{chat:n,onClick:r,isEditing:l,selectedChats:o,onDelete:c}=e,d=o.has(n.id);return(0,a.jsx)(i.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:{scale:1.01},whileTap:{scale:.99},className:"card bg-base-100 shadow-md hover:shadow-xl border transition-all cursor-pointer ".concat(d?"border-primary ring-2 ring-primary/20":"border-base-300 hover:border-primary/50"),onClick:()=>r(),children:(0,a.jsx)("div",{className:"card-body p-4",children:(0,a.jsxs)("div",{className:"grid items-center gap-4 w-full grid-cols-[min-content_1fr_min-content]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 col-start-1",children:[l&&(0,a.jsx)("input",{type:"checkbox",className:"checkbox checkbox-primary checkbox-lg",checked:d,onChange:()=>{},onClick:e=>e.stopPropagation()}),(0,a.jsx)("div",{className:"avatar",children:(0,a.jsx)("div",{className:"w-12 h-12 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2 flex items-center justify-center overflow-hidden",children:n.image?(0,a.jsx)("img",{src:n.image,alt:n.name,className:"w-full h-full object-cover"}):(0,a.jsx)("div",{className:"w-full h-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-primary-content font-bold text-lg",children:(null==(s=n.name)||null==(t=s[0])?void 0:t.toUpperCase())||"C"})})})})]}),(0,a.jsxs)("div",{className:"col-start-2 col-end-3 flex-1 min-w-0 overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-base truncate whitespace-nowrap",children:n.name}),"PENDING"===n.processingState&&(0,a.jsx)("div",{className:"tooltip tooltip-right","data-tip":"AI is processing",children:(0,a.jsx)("span",{className:"loading loading-ring loading-sm text-warning"})})]}),(0,a.jsx)("p",{className:"text-sm text-base-content/60 line-clamp-2 break-words",children:(0,a.jsx)(en.oz,{children:n.message||"No messages yet"})})]}),!l&&(0,a.jsxs)("div",{className:"flex-shrink-0 flex flex-col items-end gap-2 min-w-[84px] justify-self-end z-10",children:[(0,a.jsx)("span",{className:"text-xs text-base-content/50 whitespace-nowrap",children:n.time}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[n.unreadCount?(0,a.jsxs)("div",{className:"badge badge-primary badge-sm gap-1",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),n.unreadCount]}):n.isRead?(0,a.jsx)("div",{className:"tooltip tooltip-left","data-tip":"Read",children:(0,a.jsx)(ez,{})}):null,(0,a.jsxs)("div",{className:"dropdown dropdown-end",children:[(0,a.jsx)("button",{tabIndex:0,className:"btn btn-ghost btn-circle btn-sm",onClick:e=>e.stopPropagation(),children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),(0,a.jsx)("ul",{tabIndex:0,className:"dropdown-content z-[1] menu p-2 shadow-lg bg-base-200 rounded-box w-52",children:(0,a.jsx)("li",{children:(0,a.jsxs)("button",{onClick:e=>{e.stopPropagation(),c&&c(n.id,n.name)},className:"text-error gap-2",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete Chat"]})})})]})]})]})]})})})}function ez(){return(0,a.jsx)(eU.A,{size:18,className:"text-blue-500"})}function eB(){let[e,t]=(0,n.useState)([]),[s,r]=(0,n.useState)(!0),o=(0,M.jq)(),c=(0,z.zy)(),[d,u]=(0,n.useState)(null),m=new URLSearchParams(c.search),h=m.get("projectName")||"",p=m.get("query")||"";function g(e,t){return{id:e.id||"".concat(e.filename||"result","-").concat(t),projectId:h||"default",name:e.filename||e.name||"Result ".concat(t+1),mimeType:void 0,url:void 0,previewUrl:void 0,size:void 0,uploadedAt:e.timestamp||"",content:e.content||e.fullcontent||"",fullcontent:e.fullcontent||e.content||"",score:e.score}}return(0,n.useEffect)(()=>{async function e(){r(!0);try{let e=await ep.quicksearchDocuments(h,p);t(e||[])}catch(e){t([])}finally{r(!1)}}h&&p&&e()},[h,p]),(0,a.jsx)(ea,{children:(0,a.jsxs)("div",{className:"py-6 px-4 max-w-6xl mx-auto w-full",children:[(0,a.jsx)("div",{className:"card bg-gradient-to-br from-primary/10 to-secondary/10 border border-primary/20 mb-6",children:(0,a.jsxs)("div",{className:"card-body p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-base-content",children:"Search Results"}),(0,a.jsxs)("p",{className:"text-sm text-base-content/60",children:["Searching for:"," ",(0,a.jsxs)("span",{className:"font-semibold text-primary",children:['"',p,'"']})]})]})]}),!s&&e.length>0&&(0,a.jsxs)("div",{className:"badge badge-primary badge-lg gap-2 mt-2",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.length," ",1===e.length?"result":"results"," ","found"]})]})}),s?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 gap-4",children:[(0,a.jsx)("span",{className:"loading loading-spinner loading-lg text-primary"}),(0,a.jsx)("p",{className:"text-base-content/60",children:"Searching documents..."}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 w-full mt-8",children:Array.from({length:6}).map((e,t)=>(0,a.jsxs)("div",{className:"card bg-base-200 shadow",children:[(0,a.jsx)("div",{className:"skeleton h-48 w-full"}),(0,a.jsxs)("div",{className:"card-body p-3",children:[(0,a.jsx)("div",{className:"skeleton h-4 w-full mb-2"}),(0,a.jsx)("div",{className:"skeleton h-3 w-3/4"})]})]},t))})]}):0===e.length?(0,a.jsx)("div",{className:"card bg-base-200 border-2 border-dashed border-base-300",children:(0,a.jsxs)("div",{className:"card-body items-center text-center py-20",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-20 w-20 text-base-content/30 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"No Results Found"}),(0,a.jsxs)("p",{className:"text-base-content/60 mb-6 max-w-md",children:["We couldn't find any documents matching \"",p,'". Try different keywords or upload more documents.']}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("button",{className:"btn btn-primary gap-2",onClick:()=>o.push("/app/chats","back"),children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Chats"]}),(0,a.jsx)("button",{className:"btn btn-outline gap-2",onClick:()=>o.push("/app/chats","back"),children:"Upload Documents"})]})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8",children:(0,a.jsx)(l.N,{children:e.map((e,t)=>(0,a.jsx)(i.P.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.96},whileHover:{scale:1.02,y:-4},whileTap:{scale:.98},transition:{type:"spring",stiffness:300,damping:24},children:(0,a.jsxs)("div",{className:"card card-compact bg-base-100 shadow-md hover:shadow-xl border border-base-300 transition-all cursor-pointer group h-full",onClick:()=>u(g(e,t)),children:[(0,a.jsxs)("figure",{className:"relative h-40 bg-gradient-to-br from-base-200 to-base-300 overflow-hidden",children:[(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-base-content/20 group-hover:scale-110 transition-transform",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,a.jsxs)("div",{className:"absolute top-2 left-2 right-2 flex justify-between items-start gap-2",children:[void 0!==e.score&&(0,a.jsxs)("div",{className:"badge badge-success gap-1",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(100*e.score).toFixed(0),"%"]}),(0,a.jsxs)("div",{className:"badge badge-primary badge-sm gap-1 ml-auto",children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"View"]})]})]}),(0,a.jsxs)("div",{className:"card-body p-4",children:[(0,a.jsx)("h3",{className:"card-title text-sm font-semibold truncate",title:e.filename||e.name||"Result ".concat(t+1),children:e.filename||e.name||"Result ".concat(t+1)}),(0,a.jsx)("div",{className:"text-xs text-base-content/70 line-clamp-3 min-h-[3rem]",children:(0,a.jsx)(en.oz,{children:String(e.content||e.fullcontent||"No preview available")})}),e.timestamp&&(0,a.jsxs)("div",{className:"flex items-center gap-1 mt-2 text-xs text-base-content/50",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.timestamp]})]})]})},e&&(e.id||"".concat(e.filename,"-").concat(t))||t))})}),(0,a.jsxs)("div",{className:"divider text-sm text-base-content/50",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 inline mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"End of Results"]})]}),(0,a.jsx)("div",{className:"flex justify-center mt-8",children:(0,a.jsxs)("button",{className:"btn btn-lg btn-primary gap-2",onClick:()=>o.goBack(),children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Chats"]})}),(0,a.jsx)(er,{doc:d,onClose:()=>u(null),presentingElement:null})]})})}var eO=s(2821);s(9785);var eq=s(5889),eW=s(7842),eF=s(398),eH=s.n(eF);function eG(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,eq.QP)((0,eO.$)(t))}var eK=s(3263);function eV(e){let{item:t,className:s}=e;return(0,a.jsxs)("div",{className:eG("flex text-primary text-lg font-medium justify-between active:brightness-90 transition-all duration-300 items-center gap-2 px-4 py-3.5",s),onClick:t.onClick,children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[t.icon," ",t.label]}),t.suffix?t.suffix:t.withArrow?(0,a.jsx)(eK.A,{className:"text-gray-500",size:22}):null]})}var eX=s(8974),eJ=s(576),eY=s(9201),eZ=s(8155),eQ=s(912),e$=s(8428);function e0(){let e=(0,n.useRef)(null),t=(0,M.jq)(),[s,r]=(0,n.useState)({theme:"dark",notifications:!1}),[i,l]=(0,n.useState)(""),[o,c]=(0,n.useState)(!0);(0,n.useEffect)(()=>{!async function(){try{c(!0);let t=await ei.Ay.loadSettings();if(t){let e={...s,...t,theme:"dark"};r(e);try{"undefined"!=typeof document&&document.documentElement.setAttribute("data-theme","dark")}catch(e){console.warn("Unable to apply saved theme",e)}}else{await ei.Ay.saveSettings(s);try{"undefined"!=typeof document&&document.documentElement.setAttribute("data-theme","dark")}catch(e){console.warn("Unable to apply default theme",e)}}try{var e;let{data:t,error:s}=await b.N.auth.getUser();!s&&(null==t||null==(e=t.user)?void 0:e.email)&&l(t.user.email)}catch(e){console.warn("Unable to load supabase user",e)}}catch(e){console.error("Error loading user data:",e)}finally{c(!1)}}()},[]),(0,n.useEffect)(()=>{o||ei.Ay.saveSettings(s).catch(e=>{console.error("Error saving settings:",e)})},[s,o]);let m=()=>{r(e=>({...e,notifications:!e.notifications}))},h=[{icon:(0,a.jsx)(eJ.A,{size:22,className:"text-accent"}),label:"Notifications",withArrow:!1,onClick:m,suffix:(0,a.jsx)(e1,{enabled:s.notifications})},{icon:(0,a.jsx)(d.A,{size:22,className:"text-info"}),label:"Terms of Use",onClick:()=>{window.open("https://document-chat.com/terms-conditions/","_blank")}},{icon:(0,a.jsx)(eY.A,{size:22,className:"text-success"}),label:"Privacy Policy",onClick:()=>{window.open("https://document-chat.com/privacy-policy/","_blank")}},{icon:(0,a.jsx)(eZ.A,{size:22,className:"text-warning"}),label:"Help & Support",onClick:()=>{window.location.href="mailto:info@document-chat.com"}},{icon:(0,a.jsx)(eQ.A,{size:22,className:"text-secondary"}),label:"Share App",onClick:async()=>{await eX.S.share({title:"Messenger App",text:"Check out this awesome messenger app!",url:"http://example.com/",dialogTitle:"Share with friends"})}},{icon:(0,a.jsx)(e$.A,{size:22,className:"text-error"}),label:"Logout",onClick:async()=>{try{await b.N.auth.signOut(),(0,D.clearCachedToken)()}catch(e){console.error("Error signing out",e)}finally{t.push("/app","root","replace")}}}];return(0,a.jsxs)(ea,{pageRef:e,toolbarClassName:"bg-base-100",header:(0,a.jsx)(M.BC,{children:"Settings"}),children:[(0,a.jsx)(M.eU,{collapse:"condense",children:(0,a.jsx)(M.ai,{children:(0,a.jsx)(M.BC,{size:"large",children:"Settings"})})}),(0,a.jsx)("div",{className:"min-h-screen w-full flex flex-col items-center bg-gradient-to-b from-base-200 to-base-100 pb-8",children:(0,a.jsxs)("div",{className:"w-full max-w-md flex flex-col gap-6 p-6",children:[(0,a.jsx)("div",{className:"card bg-gradient-to-br from-primary/10 via-base-100 to-secondary/10 shadow-lg border border-base-300",children:(0,a.jsxs)("div",{className:"card-body items-center py-8",children:[(0,a.jsx)("div",{className:"avatar mb-3",children:(0,a.jsx)("div",{className:"w-20 rounded-full bg-gradient-to-br from-primary to-secondary p-1 shadow-lg ring-4 ring-base-100",children:(0,a.jsx)("div",{className:"w-full h-full rounded-full bg-base-100 flex items-center justify-center",children:(0,a.jsx)(u.A,{size:36,className:"text-primary"})})})}),(0,a.jsx)("h2",{className:"card-title text-xl font-bold mb-1",children:"Your Account"}),(0,a.jsxs)("div",{className:"badge badge-lg badge-primary badge-outline gap-2",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),i||"Not logged in"]})]})}),(0,a.jsx)("div",{className:"card bg-base-100 shadow-xl border border-base-300",children:(0,a.jsx)("div",{className:"card-body p-0",children:o?(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4 py-12",children:[(0,a.jsx)("span",{className:"loading loading-spinner loading-lg text-primary"}),(0,a.jsx)("p",{className:"text-sm text-base-content/70",children:"Loading settings..."})]}):(0,a.jsx)("ul",{className:"menu menu-lg w-full",children:h.map((e,t)=>(0,a.jsx)("li",{className:"border-b last:border-b-0 border-base-200/50",children:(0,a.jsx)(eV,{item:e,className:"flex items-center gap-4 px-4 py-4 hover:bg-base-200/50 active:bg-base-300/50 transition-colors"})},t))})})}),(0,a.jsxs)("div",{className:"text-center mt-4",children:[(0,a.jsx)("p",{className:"text-xs text-base-content/50",children:"Document Chat v1.0.0"}),(0,a.jsx)("p",{className:"text-xs text-base-content/40 mt-1",children:"Made with ❤️ for productivity"})]})]})})]})}function e1(e){let{enabled:t}=e;return(0,a.jsx)("input",{type:"checkbox",className:"toggle toggle-primary",checked:t,readOnly:!0})}function e2(){let e=(0,z.zy)(),[t,s]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{s(!e.pathname.includes("/app/chats/"))},[e]),(0,a.jsxs)(M.p4,{children:[(0,a.jsxs)(M.Rg,{children:[(0,a.jsx)(z.qh,{exact:!0,path:"/app/chats",component:eL}),(0,a.jsx)(z.qh,{exact:!0,path:"/app/quicksearch",render:e=>{let{location:t}=e;return(0,a.jsx)(eB,{})}}),(0,a.jsx)(z.qh,{path:"/app/chats/:chatId",render:e=>{let{match:t}=e;return(0,a.jsx)(eA,{chatId:t.params.chatId})}}),(0,a.jsx)(z.qh,{exact:!0,path:"/app/settings",render:()=>(0,a.jsx)(e0,{})}),(0,a.jsx)(z.qh,{exact:!0,path:"/app",children:(0,a.jsx)(z.rd,{to:"/app/chats"})})]}),t&&(0,a.jsxs)(M.Jq,{slot:"bottom",className:"bg-base-100 text-base-content",children:[(0,a.jsx)(M.qW,{tab:"/app/chats",href:"/app/chats",className:"bg-base-100 text-base-content",children:(0,a.jsx)($.A,{size:22})}),(0,a.jsx)(M.qW,{tab:"/app/settings",href:"/app/settings",className:"bg-base-100 text-base-content",children:(0,a.jsx)(ee.A,{size:22})})]})]})}let e3=!1;(0,M.Z3)({mode:"ios"});let e4=()=>{let{showSplash:e}=y(),{user:t,loading:s}=U(),r=!!e3||t,[i,l]=(0,n.useState)(""),[o,c]=(0,n.useState)();return(0,n.useEffect)(()=>{(async()=>{try{let e=await L.p.getId();l(e.identifier)}catch(e){console.error("Error getting device ID:",e)}})()},[]),(0,n.useEffect)(()=>{try{let e=localStorage.getItem("questionnaireResponses");e&&c(JSON.parse(e))}catch(e){console.error("Error loading questionnaire responses:",e)}},[]),(0,n.useEffect)(()=>{let e=window.location.hash;e&&e.includes("access_token")&&(async()=>{try{let t=new URLSearchParams(e.substring(1)),s=t.get("access_token"),a=t.get("refresh_token");if(!s)return;await b.N.auth.setSession({access_token:s,refresh_token:a});try{history.replaceState(null,"",window.location.pathname+window.location.search)}catch(e){}}catch(e){console.warn("Failed to restore Supabase session from URL fragment",e)}})()},[]),(0,a.jsxs)(M.U1,{children:[e&&(0,a.jsx)(q,{}),(0,a.jsx)(I,{userId:i,children:(0,a.jsx)(w,{questionnaireResponses:o,onQuestionnaireResponsesChange:c,children:(0,a.jsx)(R.l8,{children:(0,a.jsxs)(M.Rg,{id:"main",children:[(0,a.jsx)(z.qh,{path:"/app",render:()=>r?(0,a.jsx)(H,{children:(0,a.jsx)(e2,{})}):s&&!e3?null:(0,a.jsx)(X,{questionnaireResponses:o})}),(0,a.jsx)(z.qh,{exact:!0,path:"/",children:(0,a.jsx)(z.rd,{to:"/app"})})]})})})})]})}},3941:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";let AsyncStorage;__webpack_require__.d(__webpack_exports__,{N:()=>supabase});var _asyncMod_default,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2679),_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(815);let isNativeBuild=!0;if(isNativeBuild){try{let req=eval("require"),asyncMod=req("@react-native-async-storage/async-storage");AsyncStorage=null!=(_asyncMod_default=null==asyncMod?void 0:asyncMod.default)?_asyncMod_default:asyncMod}catch(err){}try{let req=eval("require");req("react-native-url-polyfill/auto")}catch(err){}}let supabaseUrl="https://nrbiskajvylbaprwfphz.supabase.co",supabaseAnonKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5yYmlza2FqdnlsYmFwcndmcGh6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5NTEyMTcsImV4cCI6MjA3NjUyNzIxN30.PFbrPk1RiqjuyHshuPU8pvTfK5xapj8GTBeFsGO3aJ8";if(!supabaseUrl||!supabaseAnonKey)throw Error("Supabase configuration missing. Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY (or EXPO_PUBLIC_SUPABASE_URL / EXPO_PUBLIC_SUPABASE_KEY) in your environment.");let authOptions={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!isNativeBuild,lock:_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.h0,storage:isNativeBuild?AsyncStorage:void 0},supabase=(0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.UU)(supabaseUrl,supabaseAnonKey,{auth:authOptions})},4544:(e,t,s)=>{"use strict";s.r(t),s.d(t,{clearCachedToken:()=>d,default:()=>u,getCachedIdToken:()=>c});var a=s(3941);let n=null,r=0,i=15e3,l=async e=>{var t;if(e)return e;let{data:s,error:n}=await a.N.auth.getSession();return n?(console.warn("Unable to resolve Supabase session",n),null):null!=(t=s.session)?t:null},o=(e,t)=>e.expires_at?1e3*e.expires_at:e.expires_in?Date.now()+1e3*e.expires_in:Date.now()+t;async function c(e){try{let t=Date.now();if(n&&r>t)return n;let s=await l(e);if(!s||!s.access_token)return n=null,r=0,null;let c=s.access_token,d=o(s,36e5);if(d<=t+i){let{data:e,error:t}=await a.N.auth.refreshSession();if(t)return console.warn("Supabase session refresh failed",t),n=null,r=0,null;let s=e.session;if(!s||!s.access_token)return n=null,r=0,null;c=s.access_token,d=o(s,36e5)}return n=c,r=d-i,n}catch(e){return console.warn("getCachedIdToken failed",e),n=null,r=0,null}}function d(){n=null,r=0}let u=c},8078:e=>{function t(e){return Promise.resolve().then(()=>{var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=8078,e.exports=t}}]);